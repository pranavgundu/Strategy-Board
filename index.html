<!doctype html>
<html style="background-color: #192334">
    <head>
        <title>Strategy Board</title>
        <meta name="description" content="FRC Strategy Board" />
        <link rel="icon" href="/favicon/favicon.ico" />
        <meta name="mobile-web-app-capable" content="yes" />
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta
            name="apple-mobile-web-app-status-bar-style"
            content="black-translucent"
        />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1.0, user-scalable=no"
        />
        <meta name="theme-color" content="#000000" />
        <meta name="screen-orientation" content="landscape" />
        <meta name="orientation" content="landscape" />
        <style>
            @import "tailwindcss";

            @theme {
                --breakpoint-md: 60rem;
                --breakpoint-lg: 80rem;
            }

            * {
                box-sizing: border-box;
            }

            html,
            body {
                width: 100vw;
                height: 100vh;
                margin: 0;
                padding: 0;
                overflow: hidden;
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
            }

            body {
                font-size: 16px;
            }
        </style>
        <!-- Clear button click handler removed from inline HTML.
             The application View (TypeScript) now attaches the click handler during initialization. -->
        <style id="app-debug-styles">
            /* App debug overlay styles */
            #app-debug-overlay {
                position: fixed;
                right: 12px;
                top: 12px;
                z-index: 99999;
                background: rgba(0, 0, 0, 0.88);
                color: #fff;
                padding: 12px;
                border-radius: 10px;
                font-family:
                    system-ui,
                    -apple-system,
                    "Segoe UI",
                    Roboto,
                    "Helvetica Neue",
                    Arial,
                    monospace;
                font-size: 13px;
                max-width: 360px;
                box-shadow: 0 6px 24px rgba(0, 0, 0, 0.6);
            }
            #app-debug-overlay.hidden {
                display: none;
            }
            #app-debug-overlay .status {
                font-weight: 700;
                margin-bottom: 8px;
            }
            #app-debug-overlay pre {
                white-space: pre-wrap;
                max-height: 200px;
                overflow: auto;
                background: rgba(255, 255, 255, 0.03);
                padding: 8px;
                border-radius: 6px;
                margin-top: 8px;
                font-family: monospace;
                font-size: 12px;
            }
            #app-debug-overlay button {
                background: rgba(255, 255, 255, 0.06);
                color: #fff;
                border: 0;
                padding: 6px 8px;
                margin-right: 6px;
                cursor: pointer;
                border-radius: 6px;
            }

            /* Responsive toolbar + QR overlay visuals and animations */
            /* Keep the mode selector centered while allowing left/right controls to adapt */
            #whiteboard-toolbar {
                display: grid;
                grid-template-columns: 1fr auto 1fr;
                align-items: center;
                position: relative;
                gap: 0.5rem;
            }
            #whiteboard-toolbar .toolbar-left {
                justify-self: start;
                min-width: 0;
                display: flex;
                align-items: center;
            }
            #whiteboard-toolbar .toolbar-right {
                justify-self: end;
                min-width: 0;
                display: flex;
                align-items: center;
                gap: 0.5rem;
            }
            #whiteboard-toolbar #whiteboard-toolbar-mode-select {
                justify-self: center;
                align-self: center;
                white-space: nowrap;
                min-width: 0;
                overflow: hidden;
                text-overflow: ellipsis;
                display: flex;
                align-items: center;
                gap: 1.5rem;
            }

            /* Condensed/ultra variants shrink content but keep a single toolbar row. */
            #whiteboard-toolbar.toolbar-collapsed {
                /* No-op now: keep single-row layout to prevent height growth */
                grid-template-columns: 1fr auto 1fr;
                grid-template-rows: none;
                gap: 0.5rem;
            }
            #whiteboard-toolbar.toolbar-condensed {
                gap: 0.4rem;
                padding: 0 8px;
            }
            #whiteboard-toolbar.toolbar-ultra {
                gap: 0.25rem;
                padding: 0 6px;
            }
            #whiteboard-toolbar.toolbar-condensed #whiteboard-toolbar-mode-select {
                transform: scale(0.92);
                transform-origin: center;
            }
            #whiteboard-toolbar.toolbar-ultra #whiteboard-toolbar-mode-select {
                transform: scale(0.85);
                transform-origin: center;
            }

            /* Ensure right-side buttons don't wrap and avoid overlap */
            #whiteboard-toolbar .toolbar-right button {
                flex-shrink: 0;
                white-space: nowrap;
            }

            /* Mode labels: text only, with glow matching GitHub and strategyboard.app */
            #whiteboard-toolbar #whiteboard-toolbar-mode-select > div {
                font-size: clamp(0.95rem, 2vw, 1.75rem);
                line-height: 1.1;
                cursor: pointer;
                transition: all 0.3s ease-in-out;

                /* Keep the same tap/click area and round corners, but clip any glow
                   or text-shadow so it doesn't "slop" outside the text rectangle. */
                position: relative;
                padding: 8px 16px;
                border-radius: 12px;
                overflow: hidden; /* <-- clips text-shadow / glow to the element rect */
                will-change: transform, color;
                -webkit-font-smoothing: antialiased;
            }

            /* For laptops - slightly reduce spacing but keep horizontal layout */
            @media (max-width: 1440px) and (min-width: 1025px) {
                #whiteboard-toolbar {
                    gap: 0.5rem;
                    padding: 8px 16px;
                }
                #whiteboard-toolbar .toolbar-left,
                #whiteboard-toolbar .toolbar-right {
                    gap: 0.5rem;
                }
                #whiteboard-toolbar .toolbar-left {
                    margin-left: 1rem;
                }
                #whiteboard-toolbar .toolbar-right {
                    margin-right: 1rem;
                }
                #whiteboard-toolbar .toolbar-right button,
                #whiteboard-toolbar .toolbar-left button {
                    padding: 6px 14px;
                    font-size: 0.9rem;
                }
                #whiteboard-toolbar #whiteboard-toolbar-mode-select {
                    gap: 0.75rem;
                }
                #whiteboard-toolbar #whiteboard-toolbar-mode-select > div {
                    font-size: 1.5rem !important;
                }
                /* Make export buttons slightly smaller on laptops */
                #whiteboard-toolbar-export-png,
                #whiteboard-toolbar-export-pdf {
                    min-width: 90px !important;
                    width: auto !important;
                    padding: 6px 10px !important;
                    font-size: 0.8rem !important;
                }
            }

            /* For standard tablets and landscape iPads */
            @media (max-width: 1024px) {
                /* Keep single-row toolbar; just reduce spacing and sizes */
                #whiteboard-toolbar {
                    grid-template-columns: 1fr auto 1fr;
                    align-items: center;
                    gap: 0.5rem;
                    padding: 0 10px;
                }
                #whiteboard-toolbar .toolbar-left,
                #whiteboard-toolbar .toolbar-right {
                    gap: 0.4rem;
                    margin: 0 0.5rem;
                    flex-wrap: nowrap;
                }
                #whiteboard-toolbar #whiteboard-toolbar-mode-select {
                    gap: 0.5rem;
                    white-space: nowrap;
                    overflow: hidden;
                    padding: 0 4px;
                }
                #whiteboard-toolbar .toolbar-right button,
                #whiteboard-toolbar .toolbar-left button {
                    padding: 5px 8px;
                    font-size: 0.8rem;
                    min-width: 52px;
                }
                #whiteboard-toolbar-export-png,
                #whiteboard-toolbar-export-pdf {
                    min-width: 64px !important;
                    width: auto !important;
                    padding: 4px 6px !important;
                    font-size: 0.7rem !important;
                }
                #whiteboard-toolbar .toolbar-right .flex.items-center {
                    gap: 0.25rem;
                    margin-left: 0.25rem;
                }
            }

            /* Portrait tablets and landscape phones - stack into two rows */
            @media (max-width: 834px) {
                #whiteboard-toolbar {
                    grid-template-columns: 1fr auto 1fr;
                    gap: 0.4rem;
                    padding: 0 8px;
                }
                #whiteboard-toolbar #whiteboard-toolbar-mode-select {
                    gap: 0.45rem;
                    font-size: 0.9rem;
                    white-space: nowrap;
                    overflow: hidden;
                }
                #whiteboard-toolbar .toolbar-right button,
                #whiteboard-toolbar .toolbar-left button {
                    padding: 4px 6px;
                    font-size: 0.75rem;
                    min-width: 48px;
                }
            }

            /* On narrower phones, stack into three rows (left, mode, right) so items never overlap. */
            @media (max-width: 640px) {
                #whiteboard-toolbar {
                    grid-template-columns: 1fr auto 1fr;
                    gap: 0.35rem;
                    padding: 0 6px;
                }
                #whiteboard-toolbar #whiteboard-toolbar-mode-select {
                    gap: 0.4rem;
                    font-size: 0.85rem;
                    white-space: nowrap;
                    overflow: hidden;
                }
                #whiteboard-toolbar .toolbar-right button,
                #whiteboard-toolbar .toolbar-left button {
                    padding: 4px 5px;
                    font-size: 0.8rem;
                    min-width: 44px;
                }
            }

            /* Progress bar / QR overlay animations */
            .qr-progress-wrap {
                width: 90%;
                height: 10px;
                background: rgba(255, 255, 255, 0.08);
                border-radius: 999px;
                overflow: hidden;
                margin-top: 6px;
                box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.03);
            }
            .qr-progress-bar {
                width: 0%;
                height: 100%;
                border-radius: 999px;
                background: linear-gradient(90deg, #4f46e5 0%, #06b6d4 60%);
                transition: width 300ms ease-out;
                position: relative;
                overflow: hidden;
                will-change: width;
            }
            /* subtle sheen overlay on top of bar */
            .qr-progress-bar::after {
                /* Single subtle sheen overlay for a continuous, fluid bar appearance.
                   No stripes or animations to avoid visual segmentation on iPads. */
                content: "";
                position: absolute;
                left: 0;
                top: 0;
                right: 0;
                bottom: 0;
                background: linear-gradient(
                    to right,
                    rgba(255, 255, 255, 0.08),
                    rgba(255, 255, 255, 0)
                );
                opacity: 0.15;
                pointer-events: none;
            }
            /* completed state for a neat glow */
            .qr-progress-bar.complete {
                box-shadow:
                    0 0 18px rgba(34, 197, 94, 0.25),
                    inset 0 -1px 4px rgba(0, 0, 0, 0.12);
            }

            /* Hide the per-worker textual labels that were previously appended next to each canvas;
                       keep the top status/progress bar as the single authoritative progress indicator. */
            #qr-export-code-worker-0 > div,
            #qr-export-code-worker-1 > div,
            #qr-export-code-worker-2 > div {
                display: none !important;
            }

            /* Scale QR code canvases to fill the screen without clipping */
            #qr-export-code-worker-0 canvas,
            #qr-export-code-worker-1 canvas,
            #qr-export-code-worker-2 canvas {
                max-width: 85vw;
                max-height: 65vh;
                width: auto !important;
                height: auto !important;
                object-fit: contain;
                display: block;
                margin: 0 auto;
            }

            /* Small adjustments to ensure the export overlay scales on mobile/ipad */
            #qr-export-inner-container,
            #qr-import-inner-container {
                max-width: min(92vw, 820px);
                width: 92vw;
            }

            /* Ensure canvas wrapper fills available space */
            #whiteboard-wrapper {
                position: relative;
                overflow: hidden;
            }

            #whiteboard-canvas-background,
            #whiteboard-canvas-items,
            #whiteboard-canvas-drawing {
                position: absolute;
                top: 0;
                left: 0;
            }

            /* Mode selector hover glow effects from GitHub */
            #whiteboard-toolbar-mode-select > div {
                cursor: pointer;
                padding: 8px 16px;
                border-radius: 12px;
                transition: all 0.3s ease;
            }

            #whiteboard-toolbar-mode-select > div:hover {
                color: #ffffff !important;
                text-shadow: 0 0 15px rgba(255, 255, 255, 0.8),
                             0 0 30px rgba(255, 255, 255, 0.5);
                transform: scale(1.05);
            }

            /* Draw config morphing animation */
            #whiteboard-draw-config {
                transition: all 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            }

            #whiteboard-draw-config:active {
                transform: scale(0.85) rotate(180deg);
            }

            #whiteboard-draw-config i {
                position: absolute;
                transition: all 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            }

            #whiteboard-draw-config i[style*="display: none"] {
                opacity: 0;
                transform: scale(0) rotate(-180deg);
            }

            #whiteboard-draw-config i:not([style*="display: none"]) {
                opacity: 1;
                transform: scale(1) rotate(0deg);
            }

            /* Color picker glossy effects */
            #whiteboard-color-config {
                transform-origin: bottom center;
                animation: colorPickerSlideUp 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            }

            #whiteboard-color-config.color-picker-hidden {
                animation: colorPickerSlideDown 0.3s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
                pointer-events: none;
            }

            @keyframes colorPickerSlideUp {
                from {
                    transform: translateY(20px) scale(0.8);
                    opacity: 0;
                }
                to {
                    transform: translateY(0) scale(1);
                    opacity: 1;
                }
            }

            @keyframes colorPickerSlideDown {
                from {
                    transform: translateY(0) scale(1);
                    opacity: 1;
                }
                to {
                    transform: translateY(20px) scale(0.8);
                    opacity: 0;
                }
            }

            #whiteboard-color-config > div[id*="color"] {
                position: relative;
                overflow: hidden;
                box-shadow:
                    0 4px 12px rgba(0, 0, 0, 0.3),
                    inset 0 2px 4px rgba(255, 255, 255, 0.3),
                    inset 0 -2px 4px rgba(0, 0, 0, 0.3);
                animation: colorItemSlideUp 0.3s cubic-bezier(0.34, 1.56, 0.64, 1) backwards;
            }

            #whiteboard-color-config.color-picker-hidden > div[id*="color"] {
                animation: colorItemSlideDown 0.3s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
            }

            /* Yellow appears first (at bottom of container) */
            #whiteboard-color-yellow {
                animation-delay: 0s;
            }
            #whiteboard-color-config.color-picker-hidden #whiteboard-color-yellow {
                animation-delay: 0.2s;
            }
            
            /* Green appears second */
            #whiteboard-color-green {
                animation-delay: 0.05s;
            }
            #whiteboard-color-config.color-picker-hidden #whiteboard-color-green {
                animation-delay: 0.15s;
            }
            
            /* Blue appears third */
            #whiteboard-color-blue {
                animation-delay: 0.1s;
            }
            #whiteboard-color-config.color-picker-hidden #whiteboard-color-blue {
                animation-delay: 0.1s;
            }
            
            /* Red appears fourth */
            #whiteboard-color-red {
                animation-delay: 0.15s;
            }
            #whiteboard-color-config.color-picker-hidden #whiteboard-color-red {
                animation-delay: 0.05s;
            }
            
            /* White appears fifth (at top) */
            #whiteboard-color-white {
                animation-delay: 0.2s;
            }
            #whiteboard-color-config.color-picker-hidden #whiteboard-color-white {
                animation-delay: 0s;
            }
            
            /* Close button appears with white */
            #whiteboard-color-close {
                animation-delay: 0.2s;
            }
            #whiteboard-color-config.color-picker-hidden #whiteboard-color-close {
                animation-delay: 0s;
            }

            @keyframes colorItemSlideUp {
                from {
                    opacity: 0;
                    transform: translateY(20px) scale(0.5);
                }
                to {
                    opacity: 1;
                    transform: translateY(0) scale(1);
                }
            }

            @keyframes colorItemSlideDown {
                from {
                    opacity: 1;
                    transform: translateY(0) scale(1);
                }
                to {
                    opacity: 0;
                    transform: translateY(20px) scale(0.5);
                }
            }

            #whiteboard-color-config > div[id*="color"]::before {
                content: "";
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                height: 50%;
                background: linear-gradient(
                    180deg,
                    rgba(255, 255, 255, 0.4) 0%,
                    rgba(255, 255, 255, 0.1) 50%,
                    transparent 100%
                );
                border-radius: inherit;
                pointer-events: none;
            }

            #whiteboard-color-config > div[id*="color"]:hover {
                transform: scale(1.15);
                box-shadow:
                    0 6px 16px rgba(0, 0, 0, 0.4),
                    inset 0 2px 4px rgba(255, 255, 255, 0.4),
                    inset 0 -2px 4px rgba(0, 0, 0, 0.3);
            }

            /* Toolbar button enhancements */
            #whiteboard-toolbar-back,
            #whiteboard-toolbar-undo {
                transition: all 0.3s ease;
                box-shadow:
                    0 4px 12px rgba(0, 0, 0, 0.3),
                    inset 0 1px 2px rgba(255, 255, 255, 0.2);
            }

            #whiteboard-toolbar-back:hover,
            #whiteboard-toolbar-undo:hover {
                transform: translateY(-2px);
                box-shadow:
                    0 6px 16px rgba(0, 0, 0, 0.4),
                    inset 0 1px 2px rgba(255, 255, 255, 0.3);
            }

            #whiteboard-toolbar-back:active,
            #whiteboard-toolbar-undo:active {
                transform: translateY(0);
            }

            /* Undo button disabled state */
            #whiteboard-toolbar-undo[style*="opacity: 0.5"] {
                pointer-events: none;
                filter: grayscale(0.5);
            }

            /* Glassmorphism Effects */
            .glass-button {
                backdrop-filter: blur(10px);
                -webkit-backdrop-filter: blur(10px);
                border: 1px solid rgba(255, 255, 255, 0.18);
                box-shadow:
                    0 8px 32px 0 rgba(0, 0, 0, 0.37),
                    inset 0 1px 0 0 rgba(255, 255, 255, 0.25);
                position: relative;
                overflow: hidden;
                transition: all 0.3s ease;
            }

            .glass-button:hover {
                border: 1px solid rgba(255, 255, 255, 0.3);
                box-shadow:
                    0 12px 40px 0 rgba(0, 0, 0, 0.45),
                    inset 0 1px 0 0 rgba(255, 255, 255, 0.35);
                transform: translateY(-2px);
            }

            .glass-card {
                backdrop-filter: blur(16px) saturate(180%);
                -webkit-backdrop-filter: blur(16px) saturate(180%);
                background-color: rgba(51, 65, 85, 0.75);
                border: 1px solid rgba(255, 255, 255, 0.125);
                box-shadow:
                    0 8px 32px 0 rgba(0, 0, 0, 0.37),
                    inset 0 1px 1px 0 rgba(255, 255, 255, 0.1);
            }

            /* Match item hover effect */
            #home-match-list > div:hover {
                background-color: rgba(71, 85, 105, 0.85);
                border-color: rgba(255, 255, 255, 0.2);
                box-shadow:
                    0 12px 40px 0 rgba(0, 0, 0, 0.45),
                    inset 0 1px 2px 0 rgba(255, 255, 255, 0.15);
                transform: translateY(-2px);
                transition: all 0.2s ease;
                cursor: pointer;
            }

            #home-match-list > div {
                transition: all 0.2s ease;
            }

            /* Kebab menu glow effect on hover */
            #home-match-list > div button:hover {
                filter: drop-shadow(0 0 16px rgba(255, 255, 255, 1))
                        drop-shadow(0 0 32px rgba(255, 255, 255, 1))
                        drop-shadow(0 0 48px rgba(255, 255, 255, 0.9))
                        drop-shadow(0 0 64px rgba(255, 255, 255, 0.7))
                        drop-shadow(0 0 80px rgba(255, 255, 255, 0.5));
                transition: filter 0.3s ease;
                transform: scale(1.05);
            }

            #home-match-list > div button {
                transition: filter 0.3s ease, transform 0.3s ease;
            }

            /* Contributors list hover effect - same as match items */
            #contributors-list > div:hover {
                background-color: rgba(71, 85, 105, 0.85);
                border-color: rgba(255, 255, 255, 0.2);
                box-shadow:
                    0 12px 40px 0 rgba(0, 0, 0, 0.45),
                    inset 0 1px 2px 0 rgba(255, 255, 255, 0.15);
                transform: translateY(-2px);
                transition: all 0.2s ease;
            }

            #contributors-list > div {
                transition: all 0.2s ease;
            }

            .glass-modal {
                backdrop-filter: blur(20px) saturate(180%);
                -webkit-backdrop-filter: blur(20px) saturate(180%);
                background-color: rgba(71, 85, 105, 0.8);
                border: 1px solid rgba(255, 255, 255, 0.15);
                box-shadow:
                    0 16px 48px 0 rgba(0, 0, 0, 0.5),
                    inset 0 2px 2px 0 rgba(255, 255, 255, 0.15),
                    inset 0 -2px 4px 0 rgba(0, 0, 0, 0.1);
            }

            .glass-toolbar {
                backdrop-filter: blur(12px) saturate(150%);
                -webkit-backdrop-filter: blur(12px) saturate(150%);
                background-color: rgba(63, 63, 70, 0.85);
                border-bottom: 1px solid rgba(255, 255, 255, 0.1);
                box-shadow:
                    0 4px 24px 0 rgba(0, 0, 0, 0.3),
                    inset 0 1px 0 0 rgba(255, 255, 255, 0.1);
            }

            /* Landscape orientation warning for mobile devices */
            #orientation-warning {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.95);
                z-index: 99999;
                justify-content: center;
                align-items: center;
                flex-direction: column;
                text-align: center;
                padding: 20px;
            }

            #orientation-warning .rotate-icon {
                font-size: 80px;
                margin-bottom: 40px;
                animation: rotateDevice 2s ease-in-out infinite;
                color: white;
            }

            #orientation-warning .message {
                color: white;
                font-size: 24px;
                font-weight: 600;
                margin-bottom: 10px;
                margin-top: 20px;
            }

            #orientation-warning .submessage {
                color: rgba(255, 255, 255, 0.7);
                font-size: 16px;
                margin-bottom: 30px;
            }

            #orientation-warning .dismiss-button {
                padding: 12px 24px;
                background-color: rgba(100, 116, 139, 0.8);
                color: white;
                border: 1px solid rgba(255, 255, 255, 0.2);
                border-radius: 8px;
                font-size: 16px;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.2s ease;
            }

            #orientation-warning .dismiss-button:hover {
                background-color: rgba(71, 85, 105, 0.9);
                border-color: rgba(255, 255, 255, 0.3);
            }

            @keyframes rotateDevice {
                0%,
                100% {
                    transform: rotate(0deg);
                }
                50% {
                    transform: rotate(90deg);
                }
            }

            #orientation-warning.dismissed {
                display: none !important;
            }

            /* Show warning only on mobile devices in portrait mode */
            @media (max-width: 1024px) and (orientation: portrait) {
                #orientation-warning:not(.dismissed) {
                    display: flex !important;
                }
            }

            .glossy-shine {
                position: relative;
                overflow: hidden;
            }

            /* Mode selector buttons hover glow effect */
            #whiteboard-toolbar-mode-auto,
            #whiteboard-toolbar-mode-teleop,
            #whiteboard-toolbar-mode-endgame,
            #whiteboard-toolbar-mode-notes {
                cursor: pointer;
                transition: color 0.3s ease;
            }

            #whiteboard-toolbar-mode-auto:hover,
            #whiteboard-toolbar-mode-teleop:hover,
            #whiteboard-toolbar-mode-endgame:hover,
            #whiteboard-toolbar-mode-notes:hover {
                color: white !important;
            }

            .glossy-shine::before {
                content: "";
                position: absolute;
                top: 0;
                left: -100%;
                width: 100%;
                height: 100%;
                background: linear-gradient(
                    90deg,
                    transparent,
                    rgba(255, 255, 255, 0.3) 50%,
                    transparent
                );
                transition: left 0.5s ease;
            }

            .glossy-shine:hover::before {
                left: 100%;
            }

            .glossy-shine::after {
                content: "";
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                height: 50%;
                background: linear-gradient(
                    180deg,
                    rgba(255, 255, 255, 0.2) 0%,
                    rgba(255, 255, 255, 0.05) 50%,
                    transparent 100%
                );
                pointer-events: none;
            }

            /* Frosted glass effect for backdrops */
            .backdrop-blur-xs {
                backdrop-filter: blur(8px);
                -webkit-backdrop-filter: blur(8px);
            }

            /* TBA dropdown styles */
            .tba-dropdown-item {
                padding: 10px 12px;
                cursor: pointer;
                border-bottom: 1px solid rgba(255, 255, 255, 0.1);
                transition: background-color 0.2s;
            }

            @media (min-width: 640px) {
                .tba-dropdown-item {
                    padding: 12px 16px;
                }
            }

            .tba-dropdown-item:last-child {
                border-bottom: none;
            }

            .tba-dropdown-item:hover {
                background-color: rgba(59, 130, 246, 0.3);
            }

            .tba-dropdown-item.selected {
                background-color: rgba(59, 130, 246, 0.5);
            }

            .tba-event-name {
                font-size: 0.875rem;
                font-weight: 600;
                color: #e2e8f0;
                margin-bottom: 4px;
            }

            @media (min-width: 640px) {
                .tba-event-name {
                    font-size: 1rem;
                }
            }

            .tba-event-details {
                font-size: 0.75rem;
                color: #94a3b8;
            }

            @media (min-width: 640px) {
                .tba-event-details {
                    font-size: 0.875rem;
                }
            }

            .tba-team-item {
                padding: 10px 12px;
                cursor: pointer;
                border-bottom: 1px solid rgba(255, 255, 255, 0.1);
                transition: background-color 0.2s;
                text-align: center;
                font-size: 1rem;
                color: #e2e8f0;
            }

            @media (min-width: 640px) {
                .tba-team-item {
                    padding: 12px 16px;
                    font-size: 1.125rem;
                }
            }

            .tba-team-item:last-child {
                border-bottom: none;
            }

            .tba-team-item:hover {
                background-color: rgba(59, 130, 246, 0.3);
            }

            .tba-team-item.selected {
                background-color: rgba(59, 130, 246, 0.5);
            }

            #tba-event-dropdown::-webkit-scrollbar,
            #tba-team-dropdown::-webkit-scrollbar {
                width: 8px;
            }

            #tba-event-dropdown::-webkit-scrollbar-track,
            #tba-team-dropdown::-webkit-scrollbar-track {
                background: rgba(0, 0, 0, 0.2);
                border-radius: 4px;
            }

            #tba-event-dropdown::-webkit-scrollbar-thumb,
            #tba-team-dropdown::-webkit-scrollbar-thumb {
                background: rgba(59, 130, 246, 0.5);
                border-radius: 4px;
            }

            #tba-event-dropdown::-webkit-scrollbar-thumb:hover,
            #tba-team-dropdown::-webkit-scrollbar-thumb:hover {
                background: rgba(59, 130, 246, 0.7);
            }

            /* Glow effect for strategyboard.app and GitHub logo on hover */
            #home-bottom-bar {
                overflow: visible !important;
            }

            #home-bottom-bar a {
                transition: all 0.3s ease-in-out;
            }

            #home-bottom-bar a:hover {
                text-shadow: 0 0 10px rgba(255, 255, 255, 0.8),
                            0 0 20px rgba(255, 255, 255, 0.6),
                            0 0 30px rgba(255, 255, 255, 0.4),
                            0 0 40px rgba(255, 255, 255, 0.2);
            }

            #home-bottom-bar a:hover i {
                filter: drop-shadow(0 0 6px rgba(255, 255, 255, 0.5))
                        drop-shadow(0 0 12px rgba(255, 255, 255, 0.3))
                        drop-shadow(0 0 18px rgba(255, 255, 255, 0.2));
            }
        </style>
        <script>
            (function () {
                function qs(id) {
                    return document.getElementById(id);
                }
                function log(msg) {
                    try {
                        var l = qs("app-debug-log");
                        if (l)
                            l.textContent +=
                                new Date().toLocaleTimeString() +
                                " - " +
                                msg +
                                "\n";
                    } catch (e) {}
                    console.log("APP-DEBUG:", msg);
                }

                // Instrument addEventListener to surface startup handler attachments.
                // This runs early in the page lifecycle so it can capture when the View attaches
                // event handlers to known elements during initialization.
                (function () {
                    const originalAdd = EventTarget.prototype.addEventListener;
                    EventTarget.prototype.addEventListener = function (
                        type,
                        listener,
                        options,
                    ) {
                        try {
                            const el =
                                this instanceof Element
                                    ? this
                                    : this && this.target
                                      ? this.target
                                      : null;
                            const id = el && el.id ? el.id : null;
                            const tracked = [
                                "home-toolbar-new-btn",
                                "home-toolbar-import-btn",
                                "home-toolbar-clear-btn",
                                "create-match-create-btn",
                                "create-match-cancel-btn",
                                "whiteboard-toolbar-back",
                                "whiteboard-toolbar-view-toggle",
                                "qr-export-container",
                                "qr-import-container",
                                "qr-import-inner-container",
                            ];
                            if (id && tracked.indexOf(id) !== -1) {
                                try {
                                    log(
                                        `Attached handler: "${type}" on #${id}`,
                                    );
                                } catch (err) {
                                    console.log(
                                        "APP-DEBUG: Attached handler:",
                                        type,
                                        id,
                                    );
                                }
                            }
                        } catch (err) {
                            // Non-fatal; don't break app initialization if instrumentation fails.
                            console.warn("Instrumentation failed:", err);
                        }
                        return originalAdd.call(this, type, listener, options);
                    };
                })();
                function setStatus(text) {
                    var s = qs("app-debug-status");
                    if (s) s.textContent = text;
                    log("Status: " + text);
                }
                function showOverlay() {
                    var o = qs("app-debug-overlay");
                    if (o) o.classList.remove("hidden");
                }
                function hideOverlay() {
                    var o = qs("app-debug-overlay");
                    if (o) o.classList.add("hidden");
                }
                function runSelfTest() {
                    try {
                        var newBtn = qs("home-toolbar-new-btn");
                        var panel = qs("create-match-container");
                        if (!newBtn || !panel) {
                            setStatus(
                                "Self-test: required elements missing (home-toolbar-new-btn or create-match-container)",
                            );
                            showOverlay();
                            return;
                        }
                        var beforeHidden = panel.classList.contains("hidden");
                        log("Self-test: clicking New button");
                        newBtn.click();
                        setTimeout(function () {
                            var afterHidden =
                                panel.classList.contains("hidden");
                            if (beforeHidden && !afterHidden) {
                                setStatus(
                                    "Self-test passed: create panel opened; handlers attached.",
                                );
                                // close the panel to restore state
                                var cancel = qs("create-match-cancel-btn");
                                if (cancel) cancel.click();
                                setTimeout(function () {
                                    hideOverlay();
                                }, 1200);
                            } else {
                                setStatus(
                                    "Self-test failed: create panel did not open. Event handlers may not be attached.",
                                );
                                showOverlay();
                            }
                        }, 350);
                    } catch (err) {
                        setStatus(
                            "Self-test exception: " + (err && err.message),
                        );
                        showOverlay();
                    }
                }
                function onAppInitialized() {
                    setStatus("App initialized");
                    // Self-test disabled to prevent flash on load
                }
                function onModuleError(detail) {
                    setStatus(
                        "Module failed to load: " +
                            (detail && detail.message
                                ? detail.message
                                : "unknown"),
                    );
                    showOverlay();
                }
                function onRuntimeError(ev) {
                    setStatus(
                        "Runtime error: " +
                            (ev && ev.message ? ev.message : String(ev)),
                    );
                    showOverlay();
                    log("Runtime error event: " + JSON.stringify(ev));
                }
                function onUnhandledRejection(ev) {
                    setStatus(
                        "Unhandled rejection: " +
                            (ev && ev.reason
                                ? ev.reason.message || JSON.stringify(ev.reason)
                                : String(ev)),
                    );
                    showOverlay();
                    log("Unhandled rejection: " + JSON.stringify(ev));
                }

                window.addEventListener("app:initialized", function () {
                    onAppInitialized();
                });
                window.addEventListener("app:moduleerror", function (e) {
                    onModuleError(e && e.detail);
                });
                window.addEventListener("error", function (e) {
                    onRuntimeError(e && (e.error || e));
                });
                window.addEventListener("unhandledrejection", function (e) {
                    onUnhandledRejection(e);
                });

                document.addEventListener(
                    "DOMContentLoaded",
                    function () {
                        setStatus("DOMContentLoaded — awaiting module load...");
                        // Self-test disabled to prevent flash of create match panel on page load
                        // Users can manually run self-test from debug overlay if needed
                        var selfBtn = qs("app-debug-selftest-btn");
                        if (selfBtn)
                            selfBtn.addEventListener("click", runSelfTest);
                        var reloadBtn = qs("app-debug-reload-btn");
                        if (reloadBtn)
                            reloadBtn.addEventListener("click", function () {
                                location.reload();
                            });
                    },
                    { once: true },
                );
            })();
        </script>
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta2/css/all.min.css"
            integrity="sha512-YWzhKL2whUzgiheMoBFwW8CKV4qpHQAEuvilg9FAn5VJUDwKZZxkJNuGM4XkWuk94WCrrwslk8yWNGmY1EduTA=="
            crossorigin="anonymous"
            referrerpolicy="no-referrer"
        />
    </head>
    <body class="overflow-hidden">
        <!-- Landscape orientation warning for mobile devices -->
        <div id="orientation-warning">
            <div class="rotate-icon"><i class="fas fa-mobile-alt"></i></div>
            <div class="message">Please rotate your device</div>
            <div class="submessage">This app works best in landscape mode</div>
            <button class="dismiss-button" onclick="document.getElementById('orientation-warning').classList.add('dismissed')">
                Continue in Portrait
            </button>
        </div>

        <div id="app-debug-overlay" class="hidden" aria-hidden="true">
            <div
                style="
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                "
            >
                <div id="app-debug-title" style="font-weight: 700">
                    Strategy Board — App Debug
                </div>
                <div
                    id="app-debug-timestamp"
                    style="opacity: 0.8; font-size: 12px"
                ></div>
            </div>
            <div id="app-debug-status" class="status">Starting...</div>
            <div style="margin-top: 8px">
                <button id="app-debug-selftest-btn">Run self-test</button>
                <button id="app-debug-reload-btn">Reload</button>
            </div>
            <pre id="app-debug-log"></pre>
        </div>
        <div id="home-container" class="flex flex-col w-dvw h-dvh touch-none">
            <div
                id="home-toolbar"
                class="flex items-center justify-between w-full h-16 sm:h-20 md:h-24 bg-slate-600 px-4 sm:px-8 md:px-12"
            >
                <div
                    id="home-toolbar-logo"
                    class="text-xl sm:text-2xl md:text-3xl font-extrabold text-white select-none cursor-pointer"
                    onclick="location.reload()"
                >
                    Strategy Board
                </div>
                <div class="flex gap-2 sm:gap-3 md:gap-4 text-base sm:text-xl md:text-2xl text-sky-200">
                    <button
                        id="home-toolbar-new-btn"
                        class="flex items-center justify-center w-16 sm:w-20 md:w-24 lg:w-36 h-10 sm:h-11 md:h-12 rounded-xl md:rounded-2xl bg-green-500 glass-button glossy-shine text-sm sm:text-base md:text-lg lg:text-xl"
                    >
                        New
                    </button>
                    <button
                        id="home-toolbar-tba-btn"
                        class="flex items-center justify-center w-16 sm:w-20 md:w-24 lg:w-36 h-10 sm:h-11 md:h-12 rounded-xl md:rounded-2xl bg-blue-500 glass-button glossy-shine gap-1 sm:gap-2 text-sm sm:text-base md:text-lg lg:text-xl"
                    >
                        <span>TBA</span>
                        <img src="/tba.svg" alt="TBA" class="h-5 sm:h-6 md:h-8 w-auto" />
                    </button>
                    <button
                        id="home-toolbar-import-btn"
                        class="flex items-center justify-center w-20 sm:w-28 md:w-32 lg:w-40 h-10 sm:h-11 md:h-12 rounded-xl md:rounded-2xl bg-orange-500 glass-button glossy-shine text-sm sm:text-base md:text-lg lg:text-xl"
                    >
                        <span class="hidden sm:inline">Import QR</span>
                        <span class="sm:hidden">Import</span>
                    </button>
                    <button
                        id="home-toolbar-clear-btn"
                        class="flex items-center justify-center w-16 sm:w-20 md:w-24 lg:w-36 h-10 sm:h-11 md:h-12 rounded-xl md:rounded-2xl bg-red-500 glass-button glossy-shine text-sm sm:text-base md:text-lg lg:text-xl"
                    >
                        Clear
                    </button>
                </div>
            </div>
            <div
                id="home-match-list"
                class="w-full p-6 flex-1 flex flex-col gap-2 items-center overflow-y-auto bg-slate-800"
            >
                <div
                    id="home-match-list-empty-placeholder"
                    class="absolute top-1/2 text-slate-300 text-base sm:text-lg md:text-xl italic pointer-events-none"
                >
                    Click <span class="not-italic text-white bg-green-500 px-2 py-1 rounded-lg">New</span> to add matches
                </div>
                <div
                    id="home-match-list-item-template"
                    class="hidden w-full h-20 sm:h-22 md:h-24 bg-slate-700 flex shrink-0 justify-between items-center rounded-xl glass-card px-4 sm:px-6 md:px-8"
                >
                    <div
                        class="grow-1 basis-0 text-slate-200 font-bold text-base sm:text-lg md:text-xl lg:text-2xl select-none overflow-hidden text-ellipsis whitespace-nowrap"
                    >
                        Match Name
                    </div>
                    <div class="w-1/2 flex justify-center items-center gap-2 sm:gap-4 md:gap-6">
                        <div
                            class="w-1/2 text-red-400 text-sm sm:text-base md:text-lg lg:text-2xl text-right select-none overflow-hidden text-ellipsis whitespace-nowrap"
                        >
                            000 000 000
                        </div>
                        <div
                            class="text-slate-200 text-sm sm:text-base md:text-lg lg:text-2xl select-none"
                        >
                            VS
                        </div>
                        <div
                            class="w-1/2 text-blue-400 text-sm sm:text-base md:text-lg lg:text-2xl select-none overflow-hidden text-ellipsis whitespace-nowrap"
                        >
                            000 000 000
                        </div>
                    </div>
                    <div class="grow-1 basis-0 flex h-full justify-end items-center">
                        <button
                            class="flex flex-col w-8 sm:w-10 md:w-12 gap-1 items-center justify-center"
                        >
                            <div class="w-1.5 h-1.5 sm:w-2 sm:h-2 rounded-full bg-white"></div>
                            <div class="w-1.5 h-1.5 sm:w-2 sm:h-2 rounded-full bg-white"></div>
                            <div class="w-1.5 h-1.5 sm:w-2 sm:h-2 rounded-full bg-white"></div>
                        </button>
                        <div class="hidden flex items-center justify-center gap-2">
                            <button
                                class="w-20 sm:w-24 p-1 sm:p-2 text-xs sm:text-sm md:text-base lg:text-xl text-slate-300 bg-green-500 rounded-xl glass-button glossy-shine"
                            >
                                Duplicate
                            </button>
                            <button
                                class="w-24 sm:w-32 p-1 sm:p-2 text-xs sm:text-sm md:text-base lg:text-xl text-slate-300 bg-orange-500 rounded-xl glass-button glossy-shine whitespace-nowrap"
                            >
                                Export QR
                            </button>
                            <button
                                class="w-20 sm:w-24 p-1 sm:p-2 text-xs sm:text-sm md:text-base lg:text-xl text-slate-300 bg-red-500 rounded-xl glass-button glossy-shine"
                            >
                                Delete
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <div
                id="home-bottom-bar"
                class="w-full h-16 bg-slate-700 flex items-center justify-center border-t border-slate-600 transition-all duration-300 relative"
            >
                <a
                    href="https://github.com/pranavgundu/Strategy-Board"
                    target="_blank"
                    rel="noopener noreferrer"
                    class="flex items-center gap-2 text-slate-300 hover:text-white transition-colors"
                >
                    <i class="fab fa-github text-2xl"></i>
                    <span class="text-lg font-semibold"></span>
                </a>
                <a
                    id="contributors-link-btn"
                    href="#"
                    class="absolute right-6 text-slate-300 hover:text-white transition-colors text-lg font-semibold"
                >
                    strategyboard.app
                </a>
            </div>
        </div>
        <div
            id="clear-confirm-container"
            class="hidden absolute top-0 left-0 w-dvw h-dvh backdrop-blur-xs touch-none z-50"
        >
            <div
                class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 flex flex-col items-center justify-between w-11/12 sm:w-3/4 md:w-2/3 lg:w-1/2 max-w-xl bg-slate-600 rounded-2xl md:rounded-3xl glass-modal overflow-hidden"
            >
                <div
                    class="w-full pt-6 pb-4 text-xl sm:text-2xl md:text-3xl text-center text-slate-200 font-bold"
                >
                    Clear All Data?
                </div>
                <div
                    class="w-full px-6 sm:px-8 md:px-10 pb-6 text-base sm:text-lg text-center text-slate-300"
                >
                    This will permanently delete all matches and data. This action cannot be undone.
                </div>
                <div class="flex w-full">
                    <button
                        id="clear-confirm-cancel-btn"
                        class="w-1/2 text-center text-lg sm:text-xl md:text-2xl font-bold text-slate-300 bg-slate-500 p-4 sm:p-5 md:p-6 rounded-bl-2xl md:rounded-bl-3xl glossy-shine hover:bg-slate-600 transition-colors"
                    >
                        Cancel
                    </button>
                    <button
                        id="clear-confirm-clear-btn"
                        class="w-1/2 text-center text-lg sm:text-xl md:text-2xl font-bold text-white bg-red-600 p-4 sm:p-5 md:p-6 rounded-br-2xl md:rounded-br-3xl glossy-shine hover:bg-red-700 transition-colors"
                    >
                        Clear All
                    </button>
                </div>
            </div>
        </div>
        <div
            id="create-match-container"
            class="hidden absolute top-0 left-0 w-dvw h-dvh backdrop-blur-xs touch-none"
        >
            <div
                class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 flex flex-col items-center justify-between w-11/12 sm:w-3/4 md:w-2/3 lg:w-1/2 max-w-2xl bg-slate-600 rounded-2xl md:rounded-3xl glass-modal max-h-[90vh] overflow-y-auto"
            >
                <input
                    id="create-match-name"
                    placeholder="Match Name"
                    maxlength="25"
                    class="w-full pt-4 pb-4 sm:pt-6 sm:pb-6 text-xl sm:text-2xl md:text-3xl text-center text-slate-300 font-bold rounded-t-2xl md:rounded-t-3xl bg-slate-500 outline-0"
                    autocomplete="off"
                    autocapitalize="off"
                    spellcheck="false"
                />
                <div class="grid grid-cols-3 w-full">
                    <input
                        type="number"
                        id="create-match-red-1"
                        placeholder="Red 1"
                        class="text-lg sm:text-xl md:text-2xl lg:text-3xl text-center text-red-400 p-2 sm:p-3 md:p-4 bg-slate-700 outline-0 [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none"
                        autocomplete="off"
                        autocapitalize="off"
                        spellcheck="false"
                    />
                    <input
                        type="number"
                        id="create-match-red-2"
                        placeholder="Red 2"
                        class="text-lg sm:text-xl md:text-2xl lg:text-3xl text-center text-red-400 p-2 sm:p-3 md:p-4 bg-slate-700 outline-0 [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none"
                        autocomplete="off"
                        autocapitalize="off"
                        spellcheck="false"
                    />
                    <input
                        type="number"
                        id="create-match-red-3"
                        placeholder="Red 3"
                        class="text-lg sm:text-xl md:text-2xl lg:text-3xl text-center text-red-400 p-2 sm:p-3 md:p-4 bg-slate-700 outline-0 [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none"
                        autocomplete="off"
                        autocapitalize="off"
                        spellcheck="false"
                    />
                    <input
                        type="number"
                        id="create-match-blue-1"
                        placeholder="Blue 1"
                        class="text-lg sm:text-xl md:text-2xl lg:text-3xl text-center text-blue-400 p-2 sm:p-3 md:p-4 bg-slate-700 outline-0 [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none"
                        autocomplete="off"
                        autocapitalize="off"
                        spellcheck="false"
                    />
                    <input
                        type="number"
                        id="create-match-blue-2"
                        placeholder="Blue 2"
                        class="text-lg sm:text-xl md:text-2xl lg:text-3xl text-center text-blue-400 p-2 sm:p-3 md:p-4 bg-slate-700 outline-0 [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none"
                        autocomplete="off"
                        autocapitalize="off"
                        spellcheck="false"
                    />
                    <input
                        type="number"
                        id="create-match-blue-3"
                        placeholder="Blue 3"
                        class="text-lg sm:text-xl md:text-2xl lg:text-3xl text-center text-blue-400 p-2 sm:p-3 md:p-4 bg-slate-700 outline-0 [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none"
                        autocomplete="off"
                        autocapitalize="off"
                        spellcheck="false"
                    />
                </div>
                <div class="flex w-full">
                    <button
                        id="create-match-create-btn"
                        class="w-1/2 text-center text-lg sm:text-xl md:text-2xl font-bold text-slate-300 bg-green-500 p-4 sm:p-5 md:p-6 rounded-bl-2xl md:rounded-bl-3xl glossy-shine"
                    >
                        Create
                    </button>
                    <button
                        id="create-match-cancel-btn"
                        class="w-1/2 text-center text-lg sm:text-xl md:text-2xl font-bold text-slate-300 bg-red-500 p-4 sm:p-5 md:p-6 rounded-br-2xl md:rounded-br-3xl glossy-shine"
                    >
                        Cancel
                    </button>
                </div>
            </div>
        </div>
        <div
            id="tba-import-container"
            class="hidden absolute top-0 left-0 w-dvw h-dvh backdrop-blur-xs touch-none"
        >
            <div
                class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 flex flex-col items-center justify-between w-11/12 sm:w-3/4 md:w-2/3 lg:w-1/2 max-w-2xl bg-slate-600 rounded-2xl md:rounded-3xl glass-modal max-h-[90vh] overflow-hidden"
            >
                <div
                    class="w-full pt-4 sm:pt-5 md:pt-6 pb-3 sm:pb-4 text-lg sm:text-xl md:text-2xl text-center text-slate-200 font-bold flex-shrink-0"
                >
                    Import from The Blue Alliance
                </div>
                <div class="w-full flex-1 overflow-y-auto">
                    <div class="w-full px-4 sm:px-6 md:px-8 pb-3 sm:pb-4">
                        <input
                            id="tba-api-key"
                            placeholder="TBA API Key (optional)"
                            type="password"
                            class="w-full p-2 sm:p-3 md:p-4 text-sm sm:text-base md:text-lg lg:text-xl text-center text-slate-300 rounded-lg md:rounded-xl bg-slate-700 outline-0"
                            autocomplete="off"
                            autocapitalize="off"
                            spellcheck="false"
                        />
                        <div class="text-xs sm:text-sm text-slate-400 text-center mt-2">
                            Using shared API key. Add your own at
                            <a
                                href="https://www.thebluealliance.com/account"
                                target="_blank"
                                class="text-blue-400 underline"
                                >thebluealliance.com/account</a
                            >
                            for higher rate limits
                        </div>
                    </div>
                    <div class="w-full px-4 sm:px-6 md:px-8 pb-3 sm:pb-4 relative">
                        <input
                            id="tba-event-search"
                            placeholder="Search events..."
                            class="w-full p-2 sm:p-3 md:p-4 text-sm sm:text-base md:text-lg lg:text-xl text-center text-slate-300 rounded-lg md:rounded-xl bg-slate-700 outline-0"
                            autocomplete="off"
                            autocapitalize="off"
                            spellcheck="false"
                        />
                        <div
                            id="tba-event-dropdown"
                            class="hidden absolute top-full left-4 right-4 sm:left-6 sm:right-6 md:left-8 md:right-8 mt-1 bg-slate-700 rounded-lg md:rounded-xl max-h-64 sm:max-h-80 md:max-h-96 overflow-y-auto z-50 shadow-2xl"
                        >
                            <div
                                id="tba-event-list"
                                class="flex flex-col"
                            ></div>
                        </div>
                        <input id="tba-event-key" type="hidden" />
                    </div>
                    <div class="w-full px-4 sm:px-6 md:px-8 pb-4 sm:pb-5 md:pb-6 relative">
                        <input
                            id="tba-team-search"
                            placeholder="Select event first..."
                            disabled
                            class="w-full p-2 sm:p-3 md:p-4 text-sm sm:text-base md:text-lg lg:text-xl text-center text-slate-300 rounded-lg md:rounded-xl bg-slate-700 outline-0 disabled:opacity-50"
                            autocomplete="off"
                            autocapitalize="off"
                            spellcheck="false"
                        />
                        <div
                            id="tba-team-dropdown"
                            class="hidden absolute top-full left-4 right-4 sm:left-6 sm:right-6 md:left-8 md:right-8 mt-1 bg-slate-700 rounded-lg md:rounded-xl max-h-64 sm:max-h-80 md:max-h-96 overflow-y-auto z-50 shadow-2xl"
                        >
                            <div id="tba-team-list" class="flex flex-col"></div>
                            <button
                                id="tba-all-matches-btn"
                                class="w-full p-3 sm:p-4 text-sm sm:text-base md:text-lg text-center text-slate-200 font-bold bg-green-600 hover:bg-green-500 transition-colors border-t border-slate-600"
                            >
                                All Matches
                            </button>
                        </div>
                        <input id="tba-team-number" type="hidden" />
                    </div>
                    <div
                        id="tba-status-message"
                        class="hidden w-full px-4 sm:px-6 md:px-8 pb-3 sm:pb-4 text-center text-sm sm:text-base text-slate-300"
                    ></div>
                </div>
                <div class="flex w-full flex-shrink-0">
                    <button
                        id="tba-import-btn"
                        class="w-1/2 text-center text-lg sm:text-xl md:text-2xl font-bold text-slate-300 bg-green-500 p-4 sm:p-5 md:p-6 rounded-bl-2xl md:rounded-bl-3xl glossy-shine"
                    >
                        Import
                    </button>
                    <button
                        id="tba-cancel-btn"
                        class="w-1/2 text-center text-lg sm:text-xl md:text-2xl font-bold text-slate-300 bg-red-500 p-4 sm:p-5 md:p-6 rounded-br-2xl md:rounded-br-3xl glossy-shine"
                    >
                        Cancel
                    </button>
                </div>
            </div>
        </div>
        <div
            id="qr-import-container"
            class="hidden absolute top-0 left-0 w-dvw h-dvh backdrop-blur-xs touch-none"
        >
            <div
                id="qr-import-inner-container"
                class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 flex flex-col items-center justify-between bg-slate-600 rounded-3xl p-4 glass-modal max-h-[90vh] overflow-y-auto"
            >
                <div
                    id="qr-import-status"
                    class="mb-3 text-slate-100 font-bold select-none"
                    aria-hidden="true"
                >
                    <span id="qr-import-status-text" aria-hidden="false"></span>
                    <div
                        id="qr-import-dots"
                        class="qr-dots"
                        aria-hidden="true"
                        style="display: none"
                    >
                        <div class="qr-dot"></div>
                        <div class="qr-dot"></div>
                        <div class="qr-dot"></div>
                    </div>
                </div>

                <!-- Import progress bar (top, visible on iPad and mobile) -->
                <div
                    id="qr-import-progress-wrap"
                    class="w-full flex justify-center"
                >
                    <div
                        id="qr-import-progress"
                        class="qr-progress-wrap"
                        aria-hidden="true"
                    >
                        <div
                            id="qr-import-progress-bar"
                            class="qr-progress-bar"
                            style="width: 0%"
                        ></div>
                    </div>
                </div>

                <select
                    id="qr-import-camera-select"
                    class="text-md md:text-xl mt-3 w-full rounded-xl p-2"
                ></select>
                <video
                    id="qr-import-video"
                    autoplay
                    playsinline
                    class="w-full mt-3 rounded-xl"
                    style="max-height: 44vh"
                ></video>
            </div>
        </div>
        <div
            id="qr-export-container"
            class="hidden absolute top-0 left-0 w-dvw h-dvh backdrop-blur-xs touch-none"
        >
            <!-- Inner container: clicking inside should NOT close the overlay.
                 We use an inline stopPropagation handler so the View's click-on-overlay
                 handler only runs when the backdrop itself is clicked. -->
            <div
                id="qr-export-inner-container"
                class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 flex flex-col items-center gap-3 bg-slate-600 rounded-3xl p-6 glass-modal"
                style="max-height: 95vh; max-width: 95vw; overflow: hidden"
                onclick="event.stopPropagation()"
                role="dialog"
                aria-modal="true"
            >
                <!-- Close control (explicit close button so users don't have to tap backdrop).
                     The button triggers a programmatic click on the overlay container so the
                     existing View handler handles the hide/cleanup logic. -->
                <div class="w-full flex justify-end">
                    <button
                        id="qr-export-close-btn"
                        class="text-slate-300 bg-transparent px-3 py-1 rounded-xl hover:bg-slate-700"
                        title="Close export"
                        onclick="document.getElementById('qr-export-container').click()"
                    >
                        Close
                    </button>
                </div>

                <!-- Start button to begin QR code display (will be replaced by progress indicators) -->
                <div
                    class="w-full flex flex-col items-center min-h-[60px] gap-3"
                >
                    <div class="flex gap-3">
                        <button
                            id="qr-export-start-btn"
                            class="px-8 py-3 text-xl font-bold text-white bg-green-500 rounded-xl glass-button glossy-shine hover:bg-green-600 transition-colors"
                        >
                            Start
                        </button>
                        <button
                            id="qr-export-pdf-btn"
                            class="px-8 py-3 text-xl font-bold text-white bg-purple-500 rounded-xl glass-button glossy-shine hover:bg-purple-600 transition-colors"
                        >
                            Export as PDF
                        </button>
                    </div>

                    <!-- Status area updated by the QR export code (e.g. "Page 1 / 3"). -->
                    <div
                        id="qr-export-status"
                        class="text-slate-100 font-bold select-none"
                        aria-hidden="true"
                        style="display: none"
                    >
                        <span
                            id="qr-export-status-text"
                            aria-hidden="false"
                        ></span>
                        <!-- Hiddenprepared flag for automation / accessibility: the app can reveal this
                             when the export is fully prepared (useful for keyboard users / AT). -->
                        <span
                            id="qr-export-prepared"
                            class="hidden"
                            aria-hidden="true"
                            >Prepared</span
                        >
                        <div
                            id="qr-export-dots"
                            class="qr-dots"
                            aria-hidden="true"
                            style="display: none"
                        >
                            <div class="qr-dot"></div>
                            <div class="qr-dot"></div>
                            <div class="qr-dot"></div>
                        </div>
                    </div>

                    <!-- Top progress bar: the single authoritative visual for export progress -->
                    <div
                        id="qr-export-progress-wrap"
                        class="w-full flex justify-center"
                        style="display: none"
                    >
                        <div
                            id="qr-export-progress"
                            class="qr-progress-wrap"
                            aria-hidden="true"
                        >
                            <div
                                id="qr-export-progress-bar"
                                class="qr-progress-bar"
                                style="width: 0%"
                            ></div>
                        </div>
                    </div>
                </div>

                <!-- QR worker slots (kept as separate elements so the QR export code can
                     rotate canvases into them). The per-canvas numeric labels are hidden
                     via CSS so the top progress is the only textual indicator. -->
                <div
                    class="w-full flex items-center justify-center"
                    style="min-height: 65vh; max-height: 65vh; overflow: hidden"
                >
                    <div
                        id="qr-export-code-worker-0"
                        class="hidden w-full flex items-center justify-center"
                        style="z-index: 1"
                    ></div>
                    <div
                        id="qr-export-code-worker-1"
                        class="hidden w-full flex items-center justify-center"
                        style="z-index: 2"
                    ></div>
                    <div
                        id="qr-export-code-worker-2"
                        class="hidden w-full flex items-center justify-center"
                        style="z-index: 3"
                    ></div>
                </div>
            </div>
        </div>
        <div
            id="contributors-container"
            class="hidden absolute top-0 left-0 w-dvw h-dvh backdrop-blur-xs touch-none z-50"
        >
            <div
                id="contributors-inner-container"
                class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 flex flex-col items-center w-11/12 sm:w-5/6 md:w-4/5 lg:w-3/4 max-w-6xl bg-slate-600 rounded-2xl md:rounded-3xl glass-modal max-h-[90vh] overflow-hidden"
                onclick="event.stopPropagation()"
            >
                <div class="w-full pt-6 pb-4 px-6 flex justify-between items-center border-b border-slate-500">
                    <h2 class="text-2xl sm:text-3xl md:text-4xl text-slate-200 font-bold">
                        Top Contributors
                    </h2>
                    <button
                        id="contributors-close-btn"
                        class="text-white bg-red-600 px-4 py-2 rounded-xl glass-button glossy-shine hover:bg-red-700 transition-colors font-semibold"
                    >
                        Close
                    </button>
                </div>
                
                <div id="contributors-content" class="w-full flex-1 overflow-y-auto p-6">
                    <div id="contributors-loading" class="flex flex-col items-center justify-center h-full">
                        <div class="animate-spin rounded-full h-16 w-16 border-b-2 border-white mb-4"></div>
                        <p class="text-slate-300 text-lg">Loading contributors...</p>
                    </div>
                    
                    <div id="contributors-error" class="hidden flex flex-col items-center justify-center h-full">
                        <p class="text-red-400 text-lg mb-4">Failed to load contributors</p>
                        <button
                            id="contributors-retry-btn"
                            class="px-6 py-3 bg-blue-500 text-white rounded-xl glass-button glossy-shine hover:bg-blue-600 transition-colors font-semibold"
                        >
                            Retry
                        </button>
                    </div>
                    
                    <div id="contributors-list" class="hidden grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- Contributors will be dynamically inserted here -->
                    </div>
                </div>
            </div>
        </div>
        <div
            id="whiteboard-container"
            class="hidden flex flex-col w-dvw h-dvh touch-none"
        >
            <div
                id="whiteboard-toolbar"
                class="relative items-center w-full h-12 md:h-16 bg-zinc-700 glass-toolbar"
                style="z-index: 999"
            >
                <div class="toolbar-left flex items-center ml-6 md:ml-12 gap-3">
                    <button
                        id="whiteboard-toolbar-back"
                        class="text-sm md:text-lg font-bold text-white select-none touch-none rounded-xl px-4 py-2 bg-slate-600 glass-button glossy-shine"
                    >
                        BACK
                    </button>
                    <button
                        id="whiteboard-toolbar-undo"
                        class="text-sm md:text-lg font-bold text-white select-none touch-none rounded-xl px-4 py-2 bg-amber-600 glass-button glossy-shine"
                    >
                        UNDO
                    </button>
                </div>

                <div
                    id="whiteboard-toolbar-mode-select"
                    class="toolbar-center flex justify-center items-center gap-6"
                >
                    <div
                        id="whiteboard-toolbar-mode-auto"
                        class="text-xl md:text-3xl text-zinc-100 font-extrabold select-none select-none touch-none"
                    >
                        AUTO
                    </div>
                    <div
                        id="whiteboard-toolbar-mode-teleop"
                        class="text-xl md:text-3xl text-zinc-300 select-none select-none touch-none"
                    >
                        TELEOP
                    </div>
                    <div
                        id="whiteboard-toolbar-mode-endgame"
                        class="text-xl md:text-3xl text-zinc-300 select-none select-none touch-none"
                    >
                        ENDGAME
                    </div>
                    <div
                        id="whiteboard-toolbar-mode-notes"
                        class="text-xl md:text-3xl text-zinc-300 select-none select-none touch-none"
                    >
                        NOTES
                    </div>
                </div>

                <div
                    class="toolbar-right flex items-center justify-end gap-3 mr-6 md:mr-12"
                >
                    <button
                        id="whiteboard-toolbar-view-toggle"
                        class="text-sm md:text-lg font-bold text-white select-none touch-none rounded-xl px-4 py-2 bg-slate-600 glass-button glossy-shine"
                    >
                        TOGGLE VIEW
                    </button>

                    <!-- Export controls: export the composed field (background + items + drawing) -->
                    <div class="flex items-center gap-2 ml-2">
                        <button
                            id="whiteboard-toolbar-export-png"
                            class="w-28 md:w-32 h-full text-xs md:text-sm font-semibold text-white bg-blue-500 rounded-2xl px-3 py-1 select-none touch-none glass-button glossy-shine"
                            title="Export field + annotations as PNG"
                        >
                            Export PNG
                        </button>
                        <button
                            id="whiteboard-toolbar-export-pdf"
                            class="w-28 md:w-32 h-full text-xs md:text-sm font-semibold text-white bg-green-600 rounded-2xl px-3 py-1 select-none touch-none glass-button glossy-shine"
                            title="Export field + annotations as PDF (uses print dialog)"
                        >
                            Export PDF
                        </button>
                    </div>
                </div>
            </div>
            <div
                id="whiteboard-wrapper"
                class="w-full flex-1 min-h-0 m-0 p-0 bg-zinc-900"
            >
                <canvas
                    id="whiteboard-canvas-background"
                    width="3510"
                    height="1610"
                    class="absolute m-0 select-none touch-none"
                ></canvas>
                <canvas
                    id="whiteboard-canvas-items"
                    width="3510"
                    height="1610"
                    class="absolute m-0 select-none touch-none"
                ></canvas>
                <canvas
                    id="whiteboard-canvas-drawing"
                    width="3510"
                    height="1610"
                    class="absolute m-0 select-none touch-none"
                ></canvas>
            </div>
            <div
                id="whiteboard-robot-config"
                class="hidden absolute flex flex-col justify-center items-center w-64 h-36 top-12 right-0 bg-zinc-800 rounded-b-3xl glass-card"
            >
                <div class="text-2xl text-zinc-400 font-bold mb-4 select-none">
                    Robot Config (in.)
                </div>
                <div class="flex w-full justify-center items-center">
                    <input
                        id="whiteboard-robot-config-width"
                        placeholder="width"
                        class="w-1/3 mr-4 text-3xl text-zinc-500 text-right outline-0 select-none touch-none [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none"
                        autocomplete="off"
                        autocapitalize="off"
                        spellcheck="false"
                    />
                    <div class="text-3xl text-zinc-700 text-center outline-0">
                        x
                    </div>
                    <input
                        id="whiteboard-robot-config-height"
                        placeholder="length"
                        class="w-1/3 ml-4 text-3xl text-zinc-500 text-left outline-0 select-none touch-none [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none"
                        autocomplete="off"
                        autocapitalize="off"
                        spellcheck="false"
                    />
                </div>
            </div>
            <div
                id="whiteboard-draw-config"
                class="absolute flex flex-col justify-center items-center size-12 sm:size-14 md:size-16 lg:size-20 xl:size-24 bottom-2 sm:bottom-3 md:bottom-4 right-2 sm:right-3 md:right-4 bg-zinc-800 rounded-full glass-card"
            >
                <i
                    id="whiteboard-draw-config-marker"
                    class="fa fa-pencil text-base sm:text-lg md:text-xl lg:text-2xl xl:text-3xl text-white"
                ></i>
                <i
                    id="whiteboard-draw-config-eraser"
                    class="fa fa-eraser text-base sm:text-lg md:text-xl lg:text-2xl xl:text-3xl text-white"
                    style="display: none"
                ></i>
                <i
                    id="whiteboard-draw-config-text"
                    class="fa fa-font text-base sm:text-lg md:text-xl lg:text-2xl xl:text-3xl text-white"
                    style="display: none"
                ></i>
            </div>
            <div
                id="whiteboard-color-config"
                class="absolute flex flex-col justify-center items-center bottom-2 sm:bottom-3 md:bottom-4 left-2 sm:left-3 md:left-4 bg-zinc-800 rounded-full glass-card p-1.5 sm:p-2"
            >
                <div
                    id="whiteboard-color-yellow"
                    class="size-6 sm:size-8 md:size-10 lg:size-12 xl:size-16 m-1 sm:m-1.5 md:m-2 bg-yellow-500 rounded-full border-amber-600"
                ></div>
                <div
                    id="whiteboard-color-green"
                    class="size-6 sm:size-8 md:size-10 lg:size-12 xl:size-16 m-1 sm:m-1.5 md:m-2 bg-green-500 rounded-full border-amber-500"
                ></div>
                <div
                    id="whiteboard-color-blue"
                    class="size-6 sm:size-8 md:size-10 lg:size-12 xl:size-16 m-1 sm:m-1.5 md:m-2 bg-blue-500 rounded-full border-amber-500"
                ></div>
                <div
                    id="whiteboard-color-red"
                    class="size-6 sm:size-8 md:size-10 lg:size-12 xl:size-16 m-1 sm:m-1.5 md:m-2 bg-red-500 rounded-full border-amber-500"
                ></div>
                <div
                    id="whiteboard-color-white"
                    class="size-6 sm:size-8 md:size-10 lg:size-12 xl:size-16 m-1 sm:m-1.5 md:m-2 bg-white rounded-full border-amber-500"
                ></div>
                <div
                    id="whiteboard-color-close"
                    class="size-6 sm:size-8 md:size-10 lg:size-12 xl:size-16 m-1 sm:m-1.5 md:m-2 flex justify-center items-center text-center rounded-full"
                >
                    <i
                        class="fa fa-close text-base sm:text-lg md:text-xl lg:text-2xl xl:text-3xl text-red-500"
                    ></i>
                </div>
            </div>
            <!-- Number pad for the text tool (hidden until text mode is active) -->
            <div
                id="whiteboard-number-pad"
                class="hidden absolute bottom-16 sm:bottom-20 md:bottom-24 right-2 sm:right-3 md:right-4 bg-zinc-800 rounded-2xl sm:rounded-3xl p-2 sm:p-3 grid grid-cols-3 gap-1.5 sm:gap-2 z-50 glass-card"
                aria-hidden="true"
            >
                <button
                    id="whiteboard-number-1"
                    class="p-2 sm:p-2.5 md:p-3 rounded-lg sm:rounded-xl bg-slate-700 text-white text-base sm:text-lg md:text-xl min-w-[2.5rem] sm:min-w-[3rem] md:min-w-[3.5rem]"
                >
                    1
                </button>
                <button
                    id="whiteboard-number-2"
                    class="p-2 sm:p-2.5 md:p-3 rounded-lg sm:rounded-xl bg-slate-700 text-white text-base sm:text-lg md:text-xl min-w-[2.5rem] sm:min-w-[3rem] md:min-w-[3.5rem]"
                >
                    2
                </button>
                <button
                    id="whiteboard-number-3"
                    class="p-2 sm:p-2.5 md:p-3 rounded-lg sm:rounded-xl bg-slate-700 text-white text-base sm:text-lg md:text-xl min-w-[2.5rem] sm:min-w-[3rem] md:min-w-[3.5rem]"
                >
                    3
                </button>

                <button
                    id="whiteboard-number-4"
                    class="p-2 sm:p-2.5 md:p-3 rounded-lg sm:rounded-xl bg-slate-700 text-white text-base sm:text-lg md:text-xl min-w-[2.5rem] sm:min-w-[3rem] md:min-w-[3.5rem]"
                >
                    4
                </button>
                <button
                    id="whiteboard-number-5"
                    class="p-2 sm:p-2.5 md:p-3 rounded-lg sm:rounded-xl bg-slate-700 text-white text-base sm:text-lg md:text-xl min-w-[2.5rem] sm:min-w-[3rem] md:min-w-[3.5rem]"
                >
                    5
                </button>
                <button
                    id="whiteboard-number-6"
                    class="p-2 sm:p-2.5 md:p-3 rounded-lg sm:rounded-xl bg-slate-700 text-white text-base sm:text-lg md:text-xl min-w-[2.5rem] sm:min-w-[3rem] md:min-w-[3.5rem]"
                >
                    6
                </button>

                <button
                    id="whiteboard-number-7"
                    class="p-2 sm:p-2.5 md:p-3 rounded-lg sm:rounded-xl bg-slate-700 text-white text-base sm:text-lg md:text-xl min-w-[2.5rem] sm:min-w-[3rem] md:min-w-[3.5rem]"
                >
                    7
                </button>
                <button
                    id="whiteboard-number-8"
                    class="p-2 sm:p-2.5 md:p-3 rounded-lg sm:rounded-xl bg-slate-700 text-white text-base sm:text-lg md:text-xl min-w-[2.5rem] sm:min-w-[3rem] md:min-w-[3.5rem]"
                >
                    8
                </button>
                <button
                    id="whiteboard-number-9"
                    class="p-2 sm:p-2.5 md:p-3 rounded-lg sm:rounded-xl bg-slate-700 text-white text-base sm:text-lg md:text-xl min-w-[2.5rem] sm:min-w-[3rem] md:min-w-[3.5rem]"
                >
                    9
                </button>

                <div class="col-span-3 text-center mt-1">
                    <button
                        id="whiteboard-number-0"
                        class="w-2/3 p-2 sm:p-2.5 md:p-3 rounded-lg sm:rounded-xl bg-slate-700 text-white text-base sm:text-lg md:text-xl"
                    >
                        0
                    </button>
                </div>
            </div>
        </div>
        <script>
            // Inline export helpers: compose the three canvases (background, items, drawing)
            // into a single image and either download as PNG or open a print dialog (PDF).
            (function () {
                function compositeCanvases() {
                    var bg = document.getElementById(
                        "whiteboard-canvas-background",
                    );
                    var items = document.getElementById(
                        "whiteboard-canvas-items",
                    );
                    var drawing = document.getElementById(
                        "whiteboard-canvas-drawing",
                    );
                    if (!bg || !items || !drawing) return null;

                    var w = bg.width || bg.clientWidth || 3510;
                    var h = bg.height || bg.clientHeight || 1610;
                    var out = document.createElement("canvas");
                    out.width = w;
                    out.height = h;
                    var ctx = out.getContext("2d");
                    if (!ctx) return null;

                    // Draw in the same order we render: background, items (robots), drawing (annotations)
                    ctx.drawImage(bg, 0, 0);
                    ctx.drawImage(items, 0, 0);
                    ctx.drawImage(drawing, 0, 0);

                    return out;
                }

                function downloadDataUrl(dataUrl, filename) {
                    var a = document.createElement("a");
                    a.href = dataUrl;
                    a.download = filename;
                    document.body.appendChild(a);
                    a.click();
                    a.remove();
                }

                function exportPNG(filename) {
                    var c = compositeCanvases();
                    if (!c) {
                        alert("Export failed: canvases not available");
                        return;
                    }
                    var dataUrl = c.toDataURL("image/png");
                    downloadDataUrl(dataUrl, filename || "strategy-board.png");
                }

                function exportPDF() {
                    var c = compositeCanvases();
                    if (!c) {
                        alert("Export failed: canvases not available");
                        return;
                    }
                    var dataUrl = c.toDataURL("image/png");

                    // Open in a new window and trigger the print dialog; user can choose "Save as PDF".
                    var w = window.open("", "_blank");
                    if (!w) {
                        alert(
                            "Popup blocked. Please allow popups to export as PDF.",
                        );
                        return;
                    }
                    w.document.write(
                        "<!doctype html><html><head><title>Strategy Board Export</title>",
                    );
                    w.document.write('</head><body style="margin:0">');
                    w.document.write(
                        '<img src="' +
                            dataUrl +
                            '" style="width:100%;height:auto;display:block" />',
                    );
                    w.document.write("</body></html>");
                    w.document.close();
                    w.focus();

                    // Wait for the image to load before printing to ensure it renders correctly.
                    var img = w.document.querySelector("img");
                    if (img) {
                        img.onload = function () {
                            setTimeout(function () {
                                try {
                                    w.print();
                                } catch (err) {
                                    // print may throw in some environments; ignore.
                                }
                                try {
                                    w.close();
                                } catch (err) {}
                            }, 250);
                        };
                    } else {
                        setTimeout(function () {
                            try {
                                w.print();
                            } catch (err) {}
                            try {
                                w.close();
                            } catch (err) {}
                        }, 500);
                    }
                }

                /* Progress observation moved to view.ts.
                   Duplicate inline parsing/observer functions removed to avoid
                   having two competing observers (index.html vs. view.ts).
                   The View module now installs MutationObservers and updates
                   the top progress bars (qr-export-progress-bar / qr-import-progress-bar). */

                function attachHandlers() {
                    var pngBtn = document.getElementById(
                        "whiteboard-toolbar-export-png",
                    );
                    var pdfBtn = document.getElementById(
                        "whiteboard-toolbar-export-pdf",
                    );
                    if (pngBtn) {
                        pngBtn.addEventListener("click", function () {
                            var ts = new Date()
                                .toISOString()
                                .replace(/[:.]/g, "-");
                            exportPNG("strategy-board-" + ts + ".png");
                        });
                    }
                    if (pdfBtn) {
                        pdfBtn.addEventListener("click", function () {
                            exportPDF();
                        });
                    }

                    // Reset progress when overlay is closed
                    var exportOverlay = document.getElementById(
                        "qr-export-container",
                    );
                    var exportProgressBar = document.getElementById(
                        "qr-export-progress-bar",
                    );
                    if (exportOverlay && exportProgressBar) {
                        // When overlay receives a click (backdrop) it will be closed by app's view logic.
                        exportOverlay.addEventListener("click", function () {
                            try {
                                exportProgressBar.style.width = "0%";
                                exportProgressBar.classList.remove("complete");
                            } catch (_err) {}
                        });
                    }
                    var importOverlay = document.getElementById(
                        "qr-import-container",
                    );
                    var importProgressBar = document.getElementById(
                        "qr-import-progress-bar",
                    );
                    if (importOverlay && importProgressBar) {
                        importOverlay.addEventListener("click", function () {
                            try {
                                importProgressBar.style.width = "0%";
                                importProgressBar.classList.remove("complete");
                            } catch (_err) {}
                        });
                    }

                    // Observe top status text nodes and animate progress accordingly.
                    // Progress observation is handled by view.ts (no duplicate observers here).
                }

                if (document.readyState === "loading") {
                    document.addEventListener(
                        "DOMContentLoaded",
                        attachHandlers,
                        { once: true },
                    );
                } else {
                    attachHandlers();
                }
            })();
        </script>

        <script>
            // Lock screen orientation to landscape on mobile devices
            (function () {
                // Try to lock orientation when the page loads
                async function lockOrientation() {
                    try {
                        if (screen.orientation && screen.orientation.lock) {
                            await screen.orientation.lock("landscape");
                            console.log(
                                "Screen orientation locked to landscape",
                            );
                        }
                    } catch (error) {
                        console.log(
                            "Screen orientation lock not supported or failed:",
                            error,
                        );
                    }
                }

                // Lock orientation when the page loads
                if (document.readyState === "loading") {
                    document.addEventListener(
                        "DOMContentLoaded",
                        lockOrientation,
                    );
                } else {
                    lockOrientation();
                }

                // Also try to lock when entering fullscreen (for PWA)
                document.addEventListener("fullscreenchange", lockOrientation);

                // For iOS Safari (which doesn't support screen.orientation.lock)
                // We rely on CSS media query to show the warning instead
            })();
        </script>

        <script
            type="module"
            src="./src/app.ts"
            id="app-module-script"
            crossorigin
            onload="document.dispatchEvent(new Event('app:moduleloaded'))"
            onerror="document.dispatchEvent(new CustomEvent('app:moduleerror',{detail:{message:'module load failed'}}))"
        ></script>
    </body>
</html>
