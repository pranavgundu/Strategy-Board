<!doctype html>
<html style="background-color: #192334">
    <head>
        <!-- Load critical CSS first to avoid FOUC -->
        <link rel="stylesheet" href="./styles.css" fetchpriority="high" />                
        <!-- Google tag (gtag.js) -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-D88M480QBT"></script>
        <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-D88M480QBT');
        </script>


        <title>Strategy Board</title>
        <meta name="description" content="FRC Strategy Board" />
        <link rel="icon" href="/favicon/favicon.ico" />
        <meta name="mobile-web-app-capable" content="yes" />
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta
            name="apple-mobile-web-app-status-bar-style"
            content="black-translucent"
        />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes, viewport-fit=cover"
        />
        <meta name="theme-color" content="#000000" />
        <meta name="screen-orientation" content="landscape" />
        <meta name="orientation" content="landscape" />
        
        <script>
            (function () {
                function qs(id) {
                    return document.getElementById(id);
                }
                function log(msg) {
                    try {
                        var l = qs("app-debug-log");
                        if (l)
                            l.textContent +=
                                new Date().toLocaleTimeString() +
                                " - " +
                                msg +
                                "\n";
                    } catch (e) {}
                    console.log("APP-DEBUG:", msg);
                }

                // Instrument addEventListener to surface startup handler attachments.
                // This runs early in the page lifecycle so it can capture when the View attaches
                // event handlers to known elements during initialization.
                (function () {
                    const originalAdd = EventTarget.prototype.addEventListener;
                    EventTarget.prototype.addEventListener = function (
                        type,
                        listener,
                        options,
                    ) {
                        try {
                            const el =
                                this instanceof Element
                                    ? this
                                    : this && this.target
                                      ? this.target
                                      : null;
                            const id = el && el.id ? el.id : null;
                            const tracked = [
                                "home-toolbar-new-btn",
                                "home-toolbar-import-btn",
                                "home-toolbar-clear-btn",
                                "create-match-create-btn",
                                "create-match-cancel-btn",
                                "whiteboard-toolbar-back",
                                "whiteboard-toolbar-view-toggle",
                                "qr-export-container",
                                "qr-import-container",
                                "qr-import-inner-container",
                            ];
                            if (id && tracked.indexOf(id) !== -1) {
                                try {
                                    log(
                                        `Attached handler: "${type}" on #${id}`,
                                    );
                                } catch (err) {
                                    console.log(
                                        "APP-DEBUG: Attached handler:",
                                        type,
                                        id,
                                    );
                                }
                            }
                        } catch (err) {
                            console.warn("Instrumentation failed:", err);
                        }
                        return originalAdd.call(this, type, listener, options);
                    };
                })();
                function setStatus(text) {
                    var s = qs("app-debug-status");
                    if (s) s.textContent = text;
                    log("Status: " + text);
                }
                function setLoadingMessage(text) {
                    var el = qs("app-loading-message");
                    if (el) el.textContent = text;
                }
                function hideLoadingScreen() {
                    var l = qs("app-loading");
                    if (l) l.classList.add("is-hidden");
                }
                function showLoadingScreen(text) {
                    var l = qs("app-loading");
                    if (l) l.classList.remove("is-hidden");
                    if (text) setLoadingMessage(text);
                }
                function showOverlay() {
                    var o = qs("app-debug-overlay");
                    if (o) o.classList.remove("hidden");
                }
                function hideOverlay() {
                    var o = qs("app-debug-overlay");
                    if (o) o.classList.add("hidden");
                }
                function runSelfTest() {
                    try {
                        var newBtn = qs("home-toolbar-new-btn");
                        var panel = qs("create-match-container");
                        if (!newBtn || !panel) {
                            setStatus(
                                "Self-test: required elements missing (home-toolbar-new-btn or create-match-container)",
                            );
                            showOverlay();
                            return;
                        }
                        var beforeHidden = panel.classList.contains("hidden");
                        log("Self-test: clicking New button");
                        newBtn.click();
                        setTimeout(function () {
                            var afterHidden =
                                panel.classList.contains("hidden");
                            if (beforeHidden && !afterHidden) {
                                setStatus(
                                    "Self-test passed: create panel opened; handlers attached.",
                                );
                                var cancel = qs("create-match-cancel-btn");
                                if (cancel) cancel.click();
                                setTimeout(function () {
                                    hideOverlay();
                                }, 1200);
                            } else {
                                setStatus(
                                    "Self-test failed: create panel did not open. Event handlers may not be attached.",
                                );
                                showOverlay();
                            }
                        }, 350);
                    } catch (err) {
                        setStatus(
                            "Self-test exception: " + (err && err.message),
                        );
                        showOverlay();
                    }
                }
                function onAppInitialized() {
                    setStatus("App initialized");
                }
                function onModuleError(detail) {
                    setStatus(
                        "Module failed to load: " +
                            (detail && detail.message
                                ? detail.message
                                : "unknown"),
                    );
                    showOverlay();
                }
                function onRuntimeError(ev) {
                    setStatus(
                        "Runtime error: " +
                            (ev && ev.message ? ev.message : String(ev)),
                    );
                    showOverlay();
                    log("Runtime error event: " + JSON.stringify(ev));
                }
                function onUnhandledRejection(ev) {
                    setStatus(
                        "Unhandled rejection: " +
                            (ev && ev.reason
                                ? ev.reason.message || JSON.stringify(ev.reason)
                                : String(ev)),
                    );
                    showOverlay();
                    log("Unhandled rejection: " + JSON.stringify(ev));
                }

                window.addEventListener("app:initialized", function () {
                    hideLoadingScreen();
                    onAppInitialized();
                });
                window.addEventListener("app:moduleerror", function (e) {
                    showLoadingScreen(
                        "Something went wrong loading the app. Try refreshing.",
                    );
                    onModuleError(e && e.detail);
                });
                window.addEventListener("error", function (e) {
                    onRuntimeError(e && (e.error || e));
                });
                window.addEventListener("unhandledrejection", function (e) {
                    onUnhandledRejection(e);
                });

                document.addEventListener(
                    "DOMContentLoaded",
                    function () {
                        setStatus("DOMContentLoaded — awaiting module load...");
                        setLoadingMessage("Preparing Strategy Board...");
                        var selfBtn = qs("app-debug-selftest-btn");
                        if (selfBtn)
                            selfBtn.addEventListener("click", runSelfTest);
                        var reloadBtn = qs("app-debug-reload-btn");
                        if (reloadBtn)
                            reloadBtn.addEventListener("click", function () {
                                location.reload();
                            });
                    },
                    { once: true },
                );
            })();
        </script>
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta2/css/all.min.css"
            integrity="sha512-YWzhKL2whUzgiheMoBFwW8CKV4qpHQAEuvilg9FAn5VJUDwKZZxkJNuGM4XkWuk94WCrrwslk8yWNGmY1EduTA=="
            crossorigin="anonymous"
            referrerpolicy="no-referrer"
        />
    </head>
    <body class="overflow-hidden">
        <div id="app-loading" role="status" aria-live="polite">
            <div class="loading-card">
                <div class="loading-spinner" aria-hidden="true"></div>
                <div class="loading-title">Strategy Board</div>
                <div id="app-loading-message" class="loading-subtitle">
                    Loading the playbook...
                </div>
            </div>
        </div>
        <div id="orientation-warning">
            <div class="rotate-icon"><i class="fas fa-mobile-alt"></i></div>
            <div class="message">Please rotate your device</div>
            <div class="submessage">This app works best in landscape mode</div>
            <button class="dismiss-button" onclick="document.getElementById('orientation-warning').classList.add('dismissed')">
                Continue in Portrait
            </button>
        </div>

        <div id="app-debug-overlay" class="hidden" aria-hidden="true">
            <div
                style="
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                "
            >
                <div id="app-debug-title" style="font-weight: 700">
                    Strategy Board — App Debug
                </div>
                <div
                    id="app-debug-timestamp"
                    style="opacity: 0.8; font-size: 12px"
                ></div>
            </div>
            <div id="app-debug-status" class="status">Starting...</div>
            <div style="margin-top: 8px">
                <button id="app-debug-selftest-btn">Run self-test</button>
                <button id="app-debug-reload-btn">Reload</button>
            </div>
            <pre id="app-debug-log"></pre>
        </div>
        <div id="home-container" class="flex flex-col w-dvw h-dvh touch-none">
            <div
                id="home-toolbar"
                class="flex items-center justify-between w-full h-16 sm:h-20 md:h-24 bg-slate-600 px-4 sm:px-8 md:px-12"
            >
                <div
                    id="home-toolbar-logo"
                    class="text-xl sm:text-2xl md:text-3xl font-extrabold text-white select-none cursor-pointer"
                    onclick="location.reload()"
                >
                    Strategy Board
                </div>
                <div class="flex gap-2 sm:gap-3 md:gap-4 text-base sm:text-xl md:text-2xl text-white">
                    <button
                        id="home-toolbar-new-btn"
                        class="flex items-center justify-center w-16 sm:w-20 md:w-24 lg:w-36 h-10 sm:h-11 md:h-12 rounded-xl md:rounded-2xl bg-green-500 glass-button glossy-shine text-sm sm:text-base md:text-lg lg:text-xl"
                    >
                        New
                    </button>
                    <button
                        id="home-toolbar-tba-btn"
                        class="flex items-center justify-center w-16 sm:w-20 md:w-24 lg:w-36 h-10 sm:h-11 md:h-12 rounded-xl md:rounded-2xl bg-blue-500 glass-button glossy-shine gap-1 sm:gap-2 text-sm sm:text-base md:text-lg lg:text-xl"
                    >
                        <span>TBA</span>
                        <img src="/tba.svg" alt="TBA" class="h-5 sm:h-6 md:h-8 w-auto" />
                    </button>
                    <button
                        id="home-toolbar-import-btn"
                        class="flex items-center justify-center w-20 sm:w-28 md:w-32 lg:w-40 h-10 sm:h-11 md:h-12 rounded-xl md:rounded-2xl bg-orange-500 glass-button glossy-shine text-sm sm:text-base md:text-lg lg:text-xl"
                    >
                        <span class="hidden sm:inline">Import QR</span>
                        <span class="sm:hidden">Import</span>
                    </button>
                    <button
                        id="home-toolbar-import-link-btn"
                        class="flex items-center justify-center gap-1 sm:gap-2 w-22 sm:w-28 md:w-32 lg:w-36 h-10 sm:h-11 md:h-12 rounded-xl md:rounded-2xl bg-purple-500 glass-button glossy-shine text-sm sm:text-base md:text-lg lg:text-xl"
                    >
                        <span>Import</span>
                        <i class="fas fa-link"></i>
                    </button>
                    <button
                        id="home-toolbar-clear-btn"
                        class="flex items-center justify-center w-16 sm:w-20 md:w-24 lg:w-36 h-10 sm:h-11 md:h-12 rounded-xl md:rounded-2xl bg-red-500 glass-button glossy-shine text-sm sm:text-base md:text-lg lg:text-xl"
                    >
                        Clear
                    </button>
                </div>
            </div>
            <div
                id="home-match-list"
                class="w-full p-6 flex-1 flex flex-col gap-2 items-center overflow-y-auto bg-slate-800"
            >
                <div
                    id="home-match-list-empty-placeholder"
                    class="absolute top-1/2 text-slate-300 text-base sm:text-lg md:text-xl italic pointer-events-none"
                >
                    Click <span class="not-italic text-white bg-green-500 px-2 py-1 rounded-lg">New</span> to add matches
                </div>
                <div
                    id="home-match-list-item-template"
                    class="hidden w-full h-20 sm:h-22 md:h-24 bg-slate-700 flex shrink-0 justify-between items-center rounded-xl glass-card px-4 sm:px-6 md:px-8"
                >
                    <div
                        class="grow-1 basis-0 text-slate-200 font-bold text-base sm:text-lg md:text-xl lg:text-2xl select-none overflow-hidden text-ellipsis whitespace-nowrap"
                    >
                        Match Name
                    </div>
                    <div class="w-1/2 flex justify-center items-center gap-2 sm:gap-4 md:gap-6">
                        <div
                            class="w-1/2 text-red-400 text-sm sm:text-base md:text-lg lg:text-2xl text-right select-none overflow-hidden text-ellipsis whitespace-nowrap"
                        >
                            000 000 000
                        </div>
                        <div
                            class="text-slate-200 text-sm sm:text-base md:text-lg lg:text-2xl select-none"
                        >
                            VS
                        </div>
                        <div
                            class="w-1/2 text-blue-400 text-sm sm:text-base md:text-lg lg:text-2xl select-none overflow-hidden text-ellipsis whitespace-nowrap"
                        >
                            000 000 000
                        </div>
                    </div>
                    <div class="grow-1 basis-0 flex h-full justify-end items-center">
                        <button
                            class="flex flex-col w-8 sm:w-10 md:w-12 gap-1 items-center justify-center"
                        >
                            <div class="w-1.5 h-1.5 sm:w-2 sm:h-2 rounded-full bg-white"></div>
                            <div class="w-1.5 h-1.5 sm:w-2 sm:h-2 rounded-full bg-white"></div>
                            <div class="w-1.5 h-1.5 sm:w-2 sm:h-2 rounded-full bg-white"></div>
                        </button>
                        <div class="hidden flex items-center justify-center gap-2">
                            <button
                                class="w-24 sm:w-32 p-1 sm:p-2 text-xs sm:text-sm md:text-base lg:text-xl text-white bg-green-500 rounded-xl glass-button glossy-shine"
                            >
                                Duplicate
                            </button>
                            <button
                                class="w-24 sm:w-32 p-1 sm:p-2 text-xs sm:text-sm md:text-base lg:text-xl text-white bg-blue-500 rounded-xl glass-button glossy-shine whitespace-nowrap"
                            >
                                Export QR
                            </button>
                            <button
                                class="w-24 sm:w-32 p-1 sm:p-2 text-xs sm:text-sm md:text-base lg:text-xl text-white bg-orange-500 rounded-xl glass-button glossy-shine whitespace-nowrap"
                            >
                                Export PNG
                            </button>
                            <button
                                class="w-24 sm:w-32 p-1 sm:p-2 text-xs sm:text-sm md:text-base lg:text-xl text-white bg-purple-500 rounded-xl glass-button glossy-shine whitespace-nowrap flex items-center justify-center gap-1"
                            >
                                <span>Share</span>
                                <i class="fas fa-link text-xs sm:text-sm md:text-base"></i>
                            </button>
                            <button
                                class="w-20 sm:w-24 p-1 sm:p-2 text-xs sm:text-sm md:text-base lg:text-xl text-white bg-red-500 rounded-xl glass-button glossy-shine"
                            >
                                Delete
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <div
                id="home-bottom-bar"
                class="w-full h-16 bg-slate-700 flex items-center justify-center border-t border-slate-600 transition-all duration-300 relative"
            >
                <a
                    href="https://github.com/pranavgundu/Strategy-Board"
                    target="_blank"
                    rel="noopener noreferrer"
                    class="flex items-center gap-2 text-slate-300 hover:text-white transition-colors"
                >
                    <i class="fab fa-github text-2xl"></i>
                    <span class="text-lg font-semibold"></span>
                </a>
                <div id="last-commit-info" class="absolute left-6 text-slate-400 text-xs hidden">
                    <span class="opacity-0">Loading...</span>
                </div>
                <a
                    id="contributors-link-btn"
                    href="#"
                    class="absolute right-6 flex items-center h-full text-slate-300 hover:text-white transition-colors text-lg font-semibold"
                >
                    strategyboard.app
                </a>
            </div>
        </div>
        <div
            id="clear-confirm-container"
            class="hidden absolute top-0 left-0 w-dvw h-dvh backdrop-blur-xs touch-none z-50"
        >
            <div
                class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 flex flex-col items-center justify-between w-11/12 sm:w-3/4 md:w-2/3 lg:w-1/2 max-w-xl bg-slate-600 rounded-2xl md:rounded-3xl glass-modal overflow-hidden"
            >
                <div
                    class="w-full pt-6 pb-4 text-xl sm:text-2xl md:text-3xl text-center text-slate-200 font-bold"
                >
                    Clear All Data?
                </div>
                <div
                    class="w-full px-6 sm:px-8 md:px-10 pb-6 text-base sm:text-lg text-center text-slate-300"
                >
                    This will permanently delete all matches and data. This action cannot be undone.
                </div>
                <div class="flex w-full">
                    <button
                        id="clear-confirm-cancel-btn"
                        class="w-1/2 text-center text-lg sm:text-xl md:text-2xl font-bold text-white bg-blue-500 p-4 sm:p-5 md:p-6 rounded-bl-2xl md:rounded-bl-3xl glossy-shine hover:bg-blue-600 transition-colors"
                    >
                        Cancel
                    </button>
                    <button
                        id="clear-confirm-clear-btn"
                        class="w-1/2 text-center text-lg sm:text-xl md:text-2xl font-bold text-white bg-red-500 p-4 sm:p-5 md:p-6 rounded-br-2xl md:rounded-br-3xl glossy-shine hover:bg-red-600 transition-colors"
                    >
                        Clear All
                    </button>
                </div>
            </div>
        </div>
        <div
            id="create-match-container"
            class="hidden absolute top-0 left-0 w-dvw h-dvh backdrop-blur-xs touch-none"
        >
            <div
                class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 flex flex-col items-center justify-between w-11/12 sm:w-3/4 md:w-2/3 lg:w-1/2 max-w-2xl bg-slate-600 rounded-2xl md:rounded-3xl glass-modal max-h-[90vh] overflow-y-auto"
            >
                <input
                    id="create-match-name"
                    placeholder="Match Name"
                    maxlength="25"
                    class="w-full pt-4 pb-4 sm:pt-6 sm:pb-6 text-xl sm:text-2xl md:text-3xl text-center text-slate-300 font-bold rounded-t-2xl md:rounded-t-3xl bg-slate-500 outline-0"
                    autocomplete="off"
                    autocapitalize="off"
                    spellcheck="false"
                />
                <div class="grid grid-cols-3 w-full">
                    <input
                        type="number"
                        id="create-match-red-1"
                        placeholder="Red 1"
                        class="text-lg sm:text-xl md:text-2xl lg:text-3xl text-center text-red-400 p-2 sm:p-3 md:p-4 bg-slate-700 outline-0 [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none"
                        autocomplete="off"
                        autocapitalize="off"
                        spellcheck="false"
                    />
                    <input
                        type="number"
                        id="create-match-red-2"
                        placeholder="Red 2"
                        class="text-lg sm:text-xl md:text-2xl lg:text-3xl text-center text-red-400 p-2 sm:p-3 md:p-4 bg-slate-700 outline-0 [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none"
                        autocomplete="off"
                        autocapitalize="off"
                        spellcheck="false"
                    />
                    <input
                        type="number"
                        id="create-match-red-3"
                        placeholder="Red 3"
                        class="text-lg sm:text-xl md:text-2xl lg:text-3xl text-center text-red-400 p-2 sm:p-3 md:p-4 bg-slate-700 outline-0 [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none"
                        autocomplete="off"
                        autocapitalize="off"
                        spellcheck="false"
                    />
                    <input
                        type="number"
                        id="create-match-blue-1"
                        placeholder="Blue 1"
                        class="text-lg sm:text-xl md:text-2xl lg:text-3xl text-center text-blue-400 p-2 sm:p-3 md:p-4 bg-slate-700 outline-0 [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none"
                        autocomplete="off"
                        autocapitalize="off"
                        spellcheck="false"
                    />
                    <input
                        type="number"
                        id="create-match-blue-2"
                        placeholder="Blue 2"
                        class="text-lg sm:text-xl md:text-2xl lg:text-3xl text-center text-blue-400 p-2 sm:p-3 md:p-4 bg-slate-700 outline-0 [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none"
                        autocomplete="off"
                        autocapitalize="off"
                        spellcheck="false"
                    />
                    <input
                        type="number"
                        id="create-match-blue-3"
                        placeholder="Blue 3"
                        class="text-lg sm:text-xl md:text-2xl lg:text-3xl text-center text-blue-400 p-2 sm:p-3 md:p-4 bg-slate-700 outline-0 [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none"
                        autocomplete="off"
                        autocapitalize="off"
                        spellcheck="false"
                    />
                </div>
                <div class="flex w-full">
                    <button
                        id="create-match-create-btn"
                        class="w-1/2 text-center text-lg sm:text-xl md:text-2xl font-bold text-white bg-green-500 p-4 sm:p-5 md:p-6 rounded-bl-2xl md:rounded-bl-3xl glossy-shine"
                    >
                        Create
                    </button>
                    <button
                        id="create-match-cancel-btn"
                        class="w-1/2 text-center text-lg sm:text-xl md:text-2xl font-bold text-white bg-red-500 p-4 sm:p-5 md:p-6 rounded-br-2xl md:rounded-br-3xl glossy-shine"
                    >
                        Cancel
                    </button>
                </div>
            </div>
        </div>
        <div
            id="tba-import-container"
            class="hidden absolute top-0 left-0 w-dvw h-dvh backdrop-blur-xs touch-none"
        >
            <div
                class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 flex flex-col items-center justify-between w-11/12 sm:w-3/4 md:w-2/3 lg:w-1/2 max-w-2xl bg-slate-600 rounded-2xl md:rounded-3xl glass-modal max-h-[90vh] overflow-hidden"
            >
                <div
                    class="w-full pt-4 sm:pt-5 md:pt-6 pb-3 sm:pb-4 text-lg sm:text-xl md:text-2xl text-center text-slate-200 font-bold flex-shrink-0"
                >
                    Import from The Blue Alliance
                </div>
                <div class="w-full flex-1 overflow-y-auto">
                    <div class="w-full px-4 sm:px-6 md:px-8 pb-3 sm:pb-4">
                        <input
                            id="tba-api-key"
                            placeholder="TBA API Key (optional)"
                            type="password"
                            class="w-full p-2 sm:p-3 md:p-4 text-sm sm:text-base md:text-lg lg:text-xl text-center text-slate-300 rounded-lg md:rounded-xl bg-slate-700 outline-0"
                            autocomplete="off"
                            autocapitalize="off"
                            spellcheck="false"
                        />
                        <div class="text-xs sm:text-sm text-slate-400 text-center mt-2">
                            Using shared API key. Add your own at
                            <a
                                href="https://www.thebluealliance.com/account"
                                target="_blank"
                                class="text-blue-400 underline"
                                >thebluealliance.com/account</a
                            >
                            for higher rate limits
                        </div>
                    </div>
                    <div class="w-full px-4 sm:px-6 md:px-8 pb-3 sm:pb-4 relative">
                        <input
                            id="tba-event-search"
                            placeholder="Search events..."
                            class="w-full p-2 sm:p-3 md:p-4 text-sm sm:text-base md:text-lg lg:text-xl text-center text-slate-300 rounded-lg md:rounded-xl bg-slate-700 outline-0"
                            autocomplete="off"
                            autocapitalize="off"
                            spellcheck="false"
                        />
                        <div
                            id="tba-event-dropdown"
                            class="hidden absolute top-full left-4 right-4 sm:left-6 sm:right-6 md:left-8 md:right-8 mt-1 bg-slate-700 rounded-lg md:rounded-xl max-h-64 sm:max-h-80 md:max-h-96 overflow-y-auto z-50 shadow-2xl"
                        >
                            <div
                                id="tba-event-list"
                                class="flex flex-col"
                            ></div>
                        </div>
                        <input id="tba-event-key" type="hidden" />
                    </div>
                    <div class="w-full px-4 sm:px-6 md:px-8 pb-4 sm:pb-5 md:pb-6 relative">
                        <input
                            id="tba-team-search"
                            placeholder="Select event first..."
                            disabled
                            class="w-full p-2 sm:p-3 md:p-4 text-sm sm:text-base md:text-lg lg:text-xl text-center text-slate-300 rounded-lg md:rounded-xl bg-slate-700 outline-0 disabled:opacity-50"
                            autocomplete="off"
                            autocapitalize="off"
                            spellcheck="false"
                        />
                        <div
                            id="tba-team-dropdown"
                            class="hidden absolute top-full left-4 right-4 sm:left-6 sm:right-6 md:left-8 md:right-8 mt-1 bg-slate-700 rounded-lg md:rounded-xl max-h-64 sm:max-h-80 md:max-h-96 overflow-y-auto z-50 shadow-2xl"
                        >
                            <div id="tba-team-list" class="flex flex-col"></div>
                            <button
                                id="tba-all-matches-btn"
                                class="w-full p-3 sm:p-4 text-sm sm:text-base md:text-lg text-center text-slate-200 font-bold bg-green-500 hover:bg-green-600 transition-colors border-t border-slate-600"
                            >
                                All Matches
                            </button>
                        </div>
                        <input id="tba-team-number" type="hidden" />
                    </div>
                    <div
                        id="tba-status-message"
                        class="hidden w-full px-4 sm:px-6 md:px-8 pb-3 sm:pb-4 text-center text-sm sm:text-base text-slate-300"
                    ></div>
                </div>
                <div class="flex w-full flex-shrink-0">
                    <button
                        id="tba-import-btn"
                        class="w-1/2 text-center text-lg sm:text-xl md:text-2xl font-bold text-white bg-green-500 p-4 sm:p-5 md:p-6 rounded-bl-2xl md:rounded-bl-3xl glossy-shine"
                    >
                        Import
                    </button>
                    <button
                        id="tba-cancel-btn"
                        class="w-1/2 text-center text-lg sm:text-xl md:text-2xl font-bold text-white bg-red-500 p-4 sm:p-5 md:p-6 rounded-br-2xl md:rounded-br-3xl glossy-shine"
                    >
                        Cancel
                    </button>
                </div>
            </div>
        </div>
        <div
            id="qr-import-container"
            class="hidden absolute top-0 left-0 w-dvw h-dvh backdrop-blur-xs touch-none"
        >
            <div
                id="qr-import-inner-container"
                class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 flex flex-col items-center justify-between bg-slate-600 rounded-3xl p-4 glass-modal max-h-[90vh] overflow-y-auto"
            >
                <div
                    id="qr-import-status"
                    class="mb-3 text-slate-100 font-bold select-none"
                    aria-hidden="true"
                >
                    <span id="qr-import-status-text" aria-hidden="false"></span>
                    <div
                        id="qr-import-dots"
                        class="qr-dots"
                        aria-hidden="true"
                        style="display: none"
                    >
                        <div class="qr-dot"></div>
                        <div class="qr-dot"></div>
                        <div class="qr-dot"></div>
                    </div>
                </div>

                <!-- Import progress bar (top, visible on iPad and mobile) -->
                <div
                    id="qr-import-progress-wrap"
                    class="w-full flex justify-center"
                >
                    <div
                        id="qr-import-progress"
                        class="qr-progress-wrap"
                        aria-hidden="true"
                    >
                        <div
                            id="qr-import-progress-bar"
                            class="qr-progress-bar"
                            style="width: 0%"
                        ></div>
                    </div>
                </div>

                <select
                    id="qr-import-camera-select"
                    class="text-md md:text-xl mt-3 w-full rounded-xl p-2"
                ></select>
                <video
                    id="qr-import-video"
                    autoplay
                    playsinline
                    class="w-full mt-3 rounded-xl"
                    style="max-height: 44vh"
                ></video>
            </div>
        </div>
        <div
            id="share-success-container"
            class="hidden absolute top-0 left-0 w-dvw h-dvh backdrop-blur-xs touch-none z-50"
        >
            <div
                class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 flex flex-col items-center w-11/12 sm:w-3/4 md:w-2/3 lg:w-1/2 max-w-2xl bg-slate-600 rounded-2xl md:rounded-3xl glass-modal overflow-hidden"
                onclick="event.stopPropagation()"
            >
                <div
                    class="w-full pt-6 pb-4 text-xl sm:text-2xl md:text-3xl text-center text-slate-200 font-bold"
                >
                    Share Link Generated!
                </div>
                <div
                    class="w-full px-6 sm:px-8 md:px-10 pb-6 flex flex-col gap-4"
                >
                    <div class="text-center text-slate-300">
                        <p class="text-sm sm:text-base mb-2">Share Code:</p>
                        <div class="flex items-center justify-center gap-2">
                            <p id="share-code-display" class="text-2xl sm:text-3xl md:text-4xl font-mono font-bold tracking-wider text-white bg-slate-700 px-4 py-2 rounded-xl">
                                ABC123
                            </p>
                            <button
                                id="share-code-copy-btn"
                                class="px-4 py-2 bg-blue-500 text-white rounded-xl glass-button glossy-shine hover:bg-blue-600 transition-colors"
                                title="Copy code"
                            >
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                    </div>
                    <div class="text-center text-slate-300">
                        <p class="text-sm sm:text-base mb-2">Share Link:</p>
                        <div class="flex items-center justify-center gap-2">
                            <input
                                id="share-link-display"
                                type="text"
                                readonly
                                value="https://strategyboard.app/?share=ABC123"
                                class="flex-1 text-sm sm:text-base text-slate-200 bg-slate-700 px-4 py-2 rounded-xl outline-0 font-mono"
                            />
                            <button
                                id="share-link-copy-btn"
                                class="px-4 py-2 bg-blue-500 text-white rounded-xl glass-button glossy-shine hover:bg-blue-600 transition-colors"
                                title="Copy link"
                            >
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                    </div>
                    <div class="text-center text-slate-400 text-xs sm:text-sm">
                        <i class="fas fa-info-circle"></i> Link expires in 1 week
                    </div>
                </div>
                <div class="flex w-full">
                    <button
                        id="share-success-close-btn"
                        class="w-full text-center text-lg sm:text-xl md:text-2xl font-bold text-white bg-green-500 p-4 sm:p-5 md:p-6 rounded-b-2xl md:rounded-b-3xl glossy-shine hover:bg-green-600 transition-colors"
                    >
                        Done
                    </button>
                </div>
            </div>
        </div>
        <div
            id="link-import-container"
            class="hidden absolute top-0 left-0 w-dvw h-dvh backdrop-blur-xs touch-none z-50"
        >
            <div
                class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 flex flex-col items-center justify-between w-11/12 sm:w-3/4 md:w-2/3 lg:w-1/2 max-w-xl bg-slate-600 rounded-2xl md:rounded-3xl glass-modal overflow-hidden"
            >
                <div
                    class="w-full pt-6 pb-4 text-xl sm:text-2xl md:text-3xl text-center text-slate-200 font-bold"
                >
                    Import from Link
                </div>
                <div
                    class="w-full px-6 sm:px-8 md:px-10 pb-6 text-base sm:text-lg text-center text-slate-300"
                >
                    <input
                        id="link-import-code"
                        placeholder="Enter 6-character share code"
                        maxlength="6"
                        class="w-full p-3 sm:p-4 text-lg sm:text-xl md:text-2xl text-center text-slate-200 rounded-xl bg-slate-700 outline-0 uppercase tracking-wider font-mono"
                        autocomplete="off"
                        autocapitalize="off"
                        spellcheck="false"
                    />
                    <div
                        id="link-import-status"
                        class="hidden mt-4 text-sm sm:text-base text-slate-300"
                    ></div>
                </div>
                <div class="flex w-full">
                    <button
                        id="link-import-import-btn"
                        class="w-1/2 text-center text-lg sm:text-xl md:text-2xl font-bold text-white bg-green-500 p-4 sm:p-5 md:p-6 rounded-bl-2xl md:rounded-bl-3xl glossy-shine hover:bg-green-600 transition-colors"
                    >
                        Import
                    </button>
                    <button
                        id="link-import-cancel-btn"
                        class="w-1/2 text-center text-lg sm:text-xl md:text-2xl font-bold text-white bg-red-500 p-4 sm:p-5 md:p-6 rounded-br-2xl md:rounded-br-3xl glossy-shine hover:bg-red-600 transition-colors"
                    >
                        Cancel
                    </button>
                </div>
            </div>
        </div>
        <div
            id="qr-export-container"
            class="hidden absolute top-0 left-0 w-dvw h-dvh backdrop-blur-xs touch-none z-50"
            style="touch-action: auto;"
        >
            <!-- Inner container: clicking inside should NOT close the overlay.
                 We use an inline stopPropagation handler so the View's click-on-overlay
                 handler only runs when the backdrop itself is clicked. -->
            <div
                id="qr-export-inner-container"
                class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 flex flex-col items-center gap-3 bg-slate-600 rounded-3xl p-6 glass-modal"
                style="max-height: 95vh; max-width: 95vw; overflow: hidden"
                onclick="event.stopPropagation()"
                role="dialog"
                aria-modal="true"
            >
                <!-- Close control (explicit close button so users don't have to tap backdrop).
                     The button triggers a programmatic click on the overlay container so the
                     existing View handler handles the hide/cleanup logic. -->
                <div class="w-full flex justify-end">
                    <button
                        id="qr-export-close-btn"
                        class="text-white bg-red-500 px-3 py-1 rounded-xl hover:bg-red-600 glass-button glossy-shine"
                        title="Close export"
                        onclick="document.getElementById('qr-export-container').click()"
                    >
                        Close
                    </button>
                </div>

                <!-- Start button to begin QR code display (will be replaced by progress indicators) -->
                <div
                    class="w-full flex flex-col items-center min-h-[60px] gap-3"
                >
                    <div class="flex gap-3">
                        <button
                            id="qr-export-start-btn"
                            class="px-8 py-3 text-xl font-bold text-white bg-green-500 rounded-xl glass-button glossy-shine hover:bg-green-600 transition-colors"
                        >
                            Start
                        </button>
                        <button
                            id="qr-export-pdf-btn"
                            class="px-8 py-3 text-xl font-bold text-white bg-blue-500 rounded-xl glass-button glossy-shine hover:bg-blue-600 transition-colors"
                        >
                            Export as PDF
                        </button>
                    </div>

                    <!-- Status area updated by the QR export code (e.g. "Page 1 / 3"). -->
                    <div
                        id="qr-export-status"
                        class="text-slate-100 font-bold select-none"
                        aria-hidden="true"
                        style="display: none"
                    >
                        <span
                            id="qr-export-status-text"
                            aria-hidden="false"
                        ></span>
                        <!-- Hiddenprepared flag for automation / accessibility: the app can reveal this
                             when the export is fully prepared (useful for keyboard users / AT). -->
                        <span
                            id="qr-export-prepared"
                            class="hidden"
                            aria-hidden="true"
                            >Prepared</span
                        >
                        <div
                            id="qr-export-dots"
                            class="qr-dots"
                            aria-hidden="true"
                            style="display: none"
                        >
                            <div class="qr-dot"></div>
                            <div class="qr-dot"></div>
                            <div class="qr-dot"></div>
                        </div>
                    </div>

                    <!-- Top progress bar: the single authoritative visual for export progress -->
                    <div
                        id="qr-export-progress-wrap"
                        class="w-full flex justify-center"
                        style="display: none"
                    >
                        <div
                            id="qr-export-progress"
                            class="qr-progress-wrap"
                            aria-hidden="true"
                        >
                            <div
                                id="qr-export-progress-bar"
                                class="qr-progress-bar"
                                style="width: 0%"
                            ></div>
                        </div>
                    </div>
                </div>

                <!-- QR worker slots (kept as separate elements so the QR export code can
                     rotate canvases into them). The per-canvas numeric labels are hidden
                     via CSS so the top progress is the only textual indicator. -->
                <div
                    class="w-full flex items-center justify-center"
                    style="min-height: 65vh; max-height: 65vh; overflow: hidden"
                >
                    <div
                        id="qr-export-code-worker-0"
                        class="hidden w-full flex items-center justify-center"
                        style="z-index: 1"
                    ></div>
                    <div
                        id="qr-export-code-worker-1"
                        class="hidden w-full flex items-center justify-center"
                        style="z-index: 2"
                    ></div>
                    <div
                        id="qr-export-code-worker-2"
                        class="hidden w-full flex items-center justify-center"
                        style="z-index: 3"
                    ></div>
                </div>
            </div>
        </div>
        <div
            id="contributors-container"
            class="hidden absolute top-0 left-0 w-dvw h-dvh backdrop-blur-xs touch-none z-50"
        >
            <div
                id="contributors-inner-container"
                class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 flex flex-col items-center w-11/12 sm:w-5/6 md:w-4/5 lg:w-3/4 max-w-6xl bg-slate-600 rounded-2xl md:rounded-3xl glass-modal max-h-[90vh] overflow-hidden"
                onclick="event.stopPropagation()"
            >
                <div class="w-full pt-6 pb-4 px-6 flex justify-between items-center border-b border-slate-500">
                    <h2 class="text-2xl sm:text-3xl md:text-4xl text-slate-200 font-bold">
                        Recent Contributors
                    </h2>
                    <button
                        id="contributors-close-btn"
                        class="text-white bg-red-500 px-4 py-2 rounded-xl hover:bg-red-600 transition-colors glass-button glossy-shine font-semibold"
                    >
                        Close
                    </button>
                </div>
                
                <div id="contributors-content" class="w-full flex-1 overflow-y-auto p-6">
                    <div id="contributors-loading" class="flex flex-col items-center justify-center h-full">
                        <div class="animate-spin rounded-full h-16 w-16 border-b-2 border-white mb-4"></div>
                        <p class="text-slate-300 text-lg">Loading contributors...</p>
                    </div>
                    
                    <div id="contributors-error" class="hidden flex flex-col items-center justify-center h-full">
                        <p class="text-red-400 text-lg mb-4">Failed to load contributors</p>
                        <button
                            id="contributors-retry-btn"
                            class="px-6 py-3 bg-green-500 text-white rounded-xl glass-button glossy-shine hover:bg-green-600 transition-colors font-semibold"
                        >
                            Retry
                        </button>
                    </div>
                    
                    <div id="contributors-list" class="hidden grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- Contributors will be dynamically inserted here -->
                    </div>
                </div>
            </div>
        </div>
        <div
            id="whiteboard-container"
            class="hidden flex flex-col w-dvw h-dvh touch-none"
        >
            <div
                id="whiteboard-toolbar"
                class="relative items-center w-full h-12 md:h-16 bg-zinc-700 glass-toolbar"
                style="z-index: 999"
            >
                <div class="toolbar-left flex items-center ml-6 md:ml-12 gap-3">
                    <button
                        id="whiteboard-toolbar-back"
                        class="text-sm md:text-lg font-bold text-white select-none touch-none rounded-xl px-4 py-2 bg-red-500 glass-button glossy-shine"
                    >
                        EXIT
                    </button>
                    <button
                        id="whiteboard-toolbar-undo"
                        class="text-sm md:text-lg font-bold text-white select-none touch-none rounded-xl px-4 py-2 bg-orange-500 glass-button glossy-shine"
                    >
                        UNDO
                    </button>
                </div>

                <div
                    id="whiteboard-toolbar-mode-select"
                    class="toolbar-center flex justify-center items-center gap-6"
                >
                    <div
                        id="whiteboard-toolbar-mode-auto"
                        class="text-xl md:text-3xl text-zinc-100 font-extrabold select-none select-none touch-none"
                    >
                        AUTO
                    </div>
                    <div
                        id="whiteboard-toolbar-mode-teleop"
                        class="text-xl md:text-3xl text-zinc-300 select-none select-none touch-none"
                    >
                        TELEOP
                    </div>
                    <div
                        id="whiteboard-toolbar-mode-endgame"
                        class="text-xl md:text-3xl text-zinc-300 select-none select-none touch-none"
                    >
                        ENDGAME
                    </div>
                    <div
                        id="whiteboard-toolbar-mode-notes"
                        class="text-xl md:text-3xl text-zinc-300 select-none select-none touch-none"
                    >
                        NOTES
                    </div>
                </div>

                <div
                    class="toolbar-right flex items-center justify-end gap-3 mr-6 md:mr-12"
                >
                    <button
                        id="whiteboard-toolbar-view-toggle"
                        class="text-sm md:text-lg font-bold text-white select-none touch-none rounded-xl px-4 py-2 bg-purple-500 glass-button glossy-shine"
                    >
                        TOGGLE VIEW
                    </button>
                </div>
            </div>
            <div
                id="whiteboard-wrapper"
                class="w-full flex-1 min-h-0 m-0 p-0 bg-zinc-900"
            >
                <canvas
                    id="whiteboard-canvas-background"
                    width="3510"
                    height="1610"
                    class="absolute m-0 select-none touch-none"
                ></canvas>
                <canvas
                    id="whiteboard-canvas-items"
                    width="3510"
                    height="1610"
                    class="absolute m-0 select-none touch-none"
                ></canvas>
                <canvas
                    id="whiteboard-canvas-drawing"
                    width="3510"
                    height="1610"
                    class="absolute m-0 select-none touch-none"
                ></canvas>
            </div>
            <div
                id="whiteboard-robot-config"
                class="hidden absolute flex flex-col justify-center items-center w-64 h-36 top-12 right-0 bg-zinc-800 rounded-b-3xl glass-card"
            >
                <div class="text-2xl text-zinc-400 font-bold mb-4 select-none">
                    Robot Config (in.)
                </div>
                <div class="flex w-full justify-center items-center">
                    <input
                        id="whiteboard-robot-config-width"
                        placeholder="width"
                        class="w-1/3 mr-4 text-3xl text-zinc-500 text-right outline-0 select-none touch-none [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none"
                        autocomplete="off"
                        autocapitalize="off"
                        spellcheck="false"
                    />
                    <div class="text-3xl text-zinc-700 text-center outline-0">
                        x
                    </div>
                    <input
                        id="whiteboard-robot-config-height"
                        placeholder="length"
                        class="w-1/3 ml-4 text-3xl text-zinc-500 text-left outline-0 select-none touch-none [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none"
                        autocomplete="off"
                        autocapitalize="off"
                        spellcheck="false"
                    />
                </div>
            </div>
            <div
                id="whiteboard-draw-config"
                class="absolute flex flex-col justify-center items-center size-12 sm:size-14 md:size-16 lg:size-20 xl:size-24 bottom-2 sm:bottom-3 md:bottom-4 right-2 sm:right-3 md:right-4 bg-zinc-800 rounded-full glass-card"
            >
                <i
                    id="whiteboard-draw-config-marker"
                    class="fa fa-pencil text-base sm:text-lg md:text-xl lg:text-2xl xl:text-3xl text-white"
                ></i>
                <i
                    id="whiteboard-draw-config-eraser"
                    class="fa fa-eraser text-base sm:text-lg md:text-xl lg:text-2xl xl:text-3xl text-white"
                    style="display: none"
                ></i>
                <i
                    id="whiteboard-draw-config-text"
                    class="fa fa-font text-base sm:text-lg md:text-xl lg:text-2xl xl:text-3xl text-white"
                    style="display: none"
                ></i>
                <i
                    id="whiteboard-draw-config-checkbox"
                    class="fa-regular fa-square-check text-base sm:text-lg md:text-xl lg:text-2xl xl:text-3xl text-white"
                    style="display: none"
                ></i>
            </div>
            <div
                id="whiteboard-color-config"
                class="absolute flex flex-col justify-center items-center bottom-2 sm:bottom-3 md:bottom-4 left-2 sm:left-3 md:left-4 bg-zinc-800 rounded-full glass-card p-1.5 sm:p-2"
            >
                <div
                    id="whiteboard-color-yellow"
                    class="size-6 sm:size-8 md:size-10 lg:size-12 xl:size-16 m-1 sm:m-1.5 md:m-2 bg-yellow-500 rounded-full border-amber-600"
                ></div>
                <div
                    id="whiteboard-color-green"
                    class="size-6 sm:size-8 md:size-10 lg:size-12 xl:size-16 m-1 sm:m-1.5 md:m-2 bg-green-500 rounded-full border-amber-500"
                ></div>
                <div
                    id="whiteboard-color-blue"
                    class="size-6 sm:size-8 md:size-10 lg:size-12 xl:size-16 m-1 sm:m-1.5 md:m-2 bg-blue-500 rounded-full border-amber-500"
                ></div>
                <div
                    id="whiteboard-color-red"
                    class="size-6 sm:size-8 md:size-10 lg:size-12 xl:size-16 m-1 sm:m-1.5 md:m-2 bg-red-500 rounded-full border-amber-500"
                ></div>
                <div
                    id="whiteboard-color-white"
                    class="size-6 sm:size-8 md:size-10 lg:size-12 xl:size-16 m-1 sm:m-1.5 md:m-2 bg-white rounded-full border-amber-500"
                ></div>
                <div
                    id="whiteboard-color-close"
                    class="size-6 sm:size-8 md:size-10 lg:size-12 xl:size-16 m-1 sm:m-1.5 md:m-2 flex justify-center items-center text-center rounded-full"
                >
                    <i
                        class="fa fa-close text-base sm:text-lg md:text-xl lg:text-2xl xl:text-3xl text-red-500"
                    ></i>
                </div>
            </div>
            <!-- Number pad for the text tool (hidden until text mode is active) -->
            <div
                id="whiteboard-number-pad"
                class="hidden absolute bottom-16 sm:bottom-20 md:bottom-24 right-2 sm:right-3 md:right-4 bg-zinc-800 rounded-2xl sm:rounded-3xl p-2 sm:p-3 grid grid-cols-3 gap-1.5 sm:gap-2 z-50 glass-card"
                aria-hidden="true"
            >
                <button
                    id="whiteboard-number-1"
                    class="p-2 sm:p-2.5 md:p-3 rounded-lg sm:rounded-xl bg-slate-700 text-white text-base sm:text-lg md:text-xl min-w-[2.5rem] sm:min-w-[3rem] md:min-w-[3.5rem]"
                >
                    1
                </button>
                <button
                    id="whiteboard-number-2"
                    class="p-2 sm:p-2.5 md:p-3 rounded-lg sm:rounded-xl bg-slate-700 text-white text-base sm:text-lg md:text-xl min-w-[2.5rem] sm:min-w-[3rem] md:min-w-[3.5rem]"
                >
                    2
                </button>
                <button
                    id="whiteboard-number-3"
                    class="p-2 sm:p-2.5 md:p-3 rounded-lg sm:rounded-xl bg-slate-700 text-white text-base sm:text-lg md:text-xl min-w-[2.5rem] sm:min-w-[3rem] md:min-w-[3.5rem]"
                >
                    3
                </button>

                <button
                    id="whiteboard-number-4"
                    class="p-2 sm:p-2.5 md:p-3 rounded-lg sm:rounded-xl bg-slate-700 text-white text-base sm:text-lg md:text-xl min-w-[2.5rem] sm:min-w-[3rem] md:min-w-[3.5rem]"
                >
                    4
                </button>
                <button
                    id="whiteboard-number-5"
                    class="p-2 sm:p-2.5 md:p-3 rounded-lg sm:rounded-xl bg-slate-700 text-white text-base sm:text-lg md:text-xl min-w-[2.5rem] sm:min-w-[3rem] md:min-w-[3.5rem]"
                >
                    5
                </button>
                <button
                    id="whiteboard-number-6"
                    class="p-2 sm:p-2.5 md:p-3 rounded-lg sm:rounded-xl bg-slate-700 text-white text-base sm:text-lg md:text-xl min-w-[2.5rem] sm:min-w-[3rem] md:min-w-[3.5rem]"
                >
                    6
                </button>

                <button
                    id="whiteboard-number-7"
                    class="p-2 sm:p-2.5 md:p-3 rounded-lg sm:rounded-xl bg-slate-700 text-white text-base sm:text-lg md:text-xl min-w-[2.5rem] sm:min-w-[3rem] md:min-w-[3.5rem]"
                >
                    7
                </button>
                <button
                    id="whiteboard-number-8"
                    class="p-2 sm:p-2.5 md:p-3 rounded-lg sm:rounded-xl bg-slate-700 text-white text-base sm:text-lg md:text-xl min-w-[2.5rem] sm:min-w-[3rem] md:min-w-[3.5rem]"
                >
                    8
                </button>
                <button
                    id="whiteboard-number-9"
                    class="p-2 sm:p-2.5 md:p-3 rounded-lg sm:rounded-xl bg-slate-700 text-white text-base sm:text-lg md:text-xl min-w-[2.5rem] sm:min-w-[3rem] md:min-w-[3.5rem]"
                >
                    9
                </button>

                <div class="col-span-3 text-center mt-1">
                    <button
                        id="whiteboard-number-0"
                        class="w-2/3 p-2 sm:p-2.5 md:p-3 rounded-lg sm:rounded-xl bg-slate-700 text-white text-base sm:text-lg md:text-xl"
                    >
                        0
                    </button>
                </div>
            </div>
        </div>
        <script>
            // Inline export helpers: compose the three canvases (background, items, drawing)
            // into a single image and either download as PNG or open a print dialog (PDF).
            (function () {
                function compositeCanvases() {
                    try {
                        var bg = document.getElementById(
                            "whiteboard-canvas-background",
                        );
                        var items = document.getElementById(
                            "whiteboard-canvas-items",
                        );
                        var drawing = document.getElementById(
                            "whiteboard-canvas-drawing",
                        );

                        // Better type checking
                        if (!bg || !items || !drawing) {
                            console.error("PNG Export: One or more canvases not found", {
                                bg: !!bg,
                                items: !!items,
                                drawing: !!drawing
                            });
                            return null;
                        }

                        // Verify they are canvas elements
                        if (!(bg instanceof HTMLCanvasElement) ||
                            !(items instanceof HTMLCanvasElement) ||
                            !(drawing instanceof HTMLCanvasElement)) {
                            console.error("PNG Export: Elements are not canvas elements");
                            return null;
                        }

                        var w = bg.width || 3510;
                        var h = bg.height || 1610;

                        console.log("PNG Export: Creating composite canvas", w, "x", h);

                        var out = document.createElement("canvas");
                        out.width = w;
                        out.height = h;
                        var ctx = out.getContext("2d");
                        if (!ctx) {
                            console.error("PNG Export: Failed to get 2d context");
                            return null;
                        }

                        // Draw in the same order we render: background, items (robots), drawing (annotations)
                        ctx.drawImage(bg, 0, 0);
                        ctx.drawImage(items, 0, 0);
                        ctx.drawImage(drawing, 0, 0);

                        console.log("PNG Export: Composite canvas created successfully");
                        return out;
                    } catch (err) {
                        console.error("PNG Export: Error in compositeCanvases", err);
                        return null;
                    }
                }

                function downloadDataUrl(dataUrl, filename) {
                    var a = document.createElement("a");
                    a.href = dataUrl;
                    a.download = filename;
                    document.body.appendChild(a);
                    a.click();
                    a.remove();
                }

                function exportPNG(filename) {
                    var c = compositeCanvases();
                    if (!c) {
                        alert("Export failed: canvases not available");
                        return;
                    }
                    var dataUrl = c.toDataURL("image/png");
                    downloadDataUrl(dataUrl, filename || "strategy-board.png");
                }

                function exportPDF() {
                    var c = compositeCanvases();
                    if (!c) {
                        alert("Export failed: canvases not available");
                        return;
                    }
                    var dataUrl = c.toDataURL("image/png");

                    // Open in a new window and trigger the print dialog; user can choose "Save as PDF".
                    var w = window.open("", "_blank");
                    if (!w) {
                        alert(
                            "Popup blocked. Please allow popups to export as PDF.",
                        );
                        return;
                    }
                    w.document.write(
                        "<!doctype html><html><head><title>Strategy Board Export</title>",
                    );
                    w.document.write('</head><body style="margin:0">');
                    w.document.write(
                        '<img src="' +
                            dataUrl +
                            '" style="width:100%;height:auto;display:block" />',
                    );
                    w.document.write("</body></html>");
                    w.document.close();
                    w.focus();

                    // Wait for the image to load before printing to ensure it renders correctly.
                    var img = w.document.querySelector("img");
                    if (img) {
                        img.onload = function () {
                            setTimeout(function () {
                                try {
                                    w.print();
                                } catch (err) {
                                    // print may throw in some environments; ignore.
                                }
                                try {
                                    w.close();
                                } catch (err) {}
                            }, 250);
                        };
                    } else {
                        setTimeout(function () {
                            try {
                                w.print();
                            } catch (err) {}
                            try {
                                w.close();
                            } catch (err) {}
                        }, 500);
                    }
                }

                /* Progress observation moved to view.ts.
                   Duplicate inline parsing/observer functions removed to avoid
                   having two competing observers (index.html vs. view.ts).
                   The View module now installs MutationObservers and updates
                   the top progress bars (qr-export-progress-bar / qr-import-progress-bar). */

                function attachHandlers() {
                    // Reset progress when overlay is closed
                    var exportOverlay = document.getElementById(
                        "qr-export-container",
                    );
                    var exportProgressBar = document.getElementById(
                        "qr-export-progress-bar",
                    );
                    if (exportOverlay && exportProgressBar) {
                        // When overlay receives a click (backdrop) it will be closed by app's view logic.
                        exportOverlay.addEventListener("click", function () {
                            try {
                                exportProgressBar.style.width = "0%";
                                exportProgressBar.classList.remove("complete");
                            } catch (_err) {}
                        });
                    }
                    var importOverlay = document.getElementById(
                        "qr-import-container",
                    );
                    var importProgressBar = document.getElementById(
                        "qr-import-progress-bar",
                    );
                    if (importOverlay && importProgressBar) {
                        importOverlay.addEventListener("click", function () {
                            try {
                                importProgressBar.style.width = "0%";
                                importProgressBar.classList.remove("complete");
                            } catch (_err) {}
                        });
                    }

                    // Observe top status text nodes and animate progress accordingly.
                    // Progress observation is handled by view.ts (no duplicate observers here).
                }

                // Expose export functions to global scope for use by TypeScript modules
                window.exportPNG = exportPNG;
                window.exportPDF = exportPDF;

                if (document.readyState === "loading") {
                    document.addEventListener(
                        "DOMContentLoaded",
                        attachHandlers,
                        { once: true },
                    );
                } else {
                    attachHandlers();
                }
            })();
        </script>

        <script>
            // Lock screen orientation to landscape on mobile devices
            (function () {
                // Try to lock orientation when the page loads
                async function lockOrientation() {
                    try {
                        if (screen.orientation && screen.orientation.lock) {
                            await screen.orientation.lock("landscape");
                            console.log(
                                "Screen orientation locked to landscape",
                            );
                        }
                    } catch (error) {
                        console.log(
                            "Screen orientation lock not supported or failed:",
                            error,
                        );
                    }
                }

                // Lock orientation when the page loads
                if (document.readyState === "loading") {
                    document.addEventListener(
                        "DOMContentLoaded",
                        lockOrientation,
                    );
                } else {
                    lockOrientation();
                }

                // Also try to lock when entering fullscreen (for PWA)
                document.addEventListener("fullscreenchange", lockOrientation);

                // For iOS Safari (which doesn't support screen.orientation.lock)
                // We rely on CSS media query to show the warning instead
            })();
        </script>

        <script
            type="module"
            src="./src/app.ts"
            id="app-module-script"
            crossorigin
            onload="document.dispatchEvent(new Event('app:moduleloaded'))"
            onerror="document.dispatchEvent(new CustomEvent('app:moduleerror',{detail:{message:'module load failed'}}))"
        ></script>
    </body>
</html>
